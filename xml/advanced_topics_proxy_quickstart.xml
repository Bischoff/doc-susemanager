<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook50-profile.xsl"
                 type="text/xml" 
                 title="Profiling step"?>
<!DOCTYPE chapter
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="advanced.topics.proxy.quickstart">
 <title>&susemgr; &productnumber3; Proxy</title>


 <para> This guide explains how to install and set up &susemgr; &productnumber3; Proxy. </para>


 <sect1 xml:id="at.manager.proxy.concepts">
  <title>Overview</title>
  <para> &susemgr; &productnumber3; Proxy is a &susemgr; add-on that caches software packages on an
   internal, central server. The proxy caches patch updates from &suse; or custom RPMs generated by
   third-party organizations. A proxy allows you to use bandwidth more effectively because client
   systems connect to the proxy for updates, and the &susemgr; server is no longer required to
   handle all client requests. The proxy also supports transparent custom package deployment. </para>

  <para> &susemgr; Proxy is an open source (GPLv2) solution that provides the following features: </para>

  <itemizedlist>
   <listitem>
    <para> Cache software packages within a Squid proxy. </para>
   </listitem>
   <listitem>
    <para> Client systems see the &susemgrproxy; as a &susemgr; server instance. </para>
   </listitem>
   <listitem>
    <para> The &susemgrproxy; is registered as a client system with the &susemgr; server. </para>
   </listitem>
  </itemizedlist>


  <para> The primary goal of a &susemgrproxy; is to improve &susemgr; performance by reducing
   bandwidth requirements and accelerating response time. </para>
 </sect1>

 <sect1 xml:id="at.manager.proxy.requirements">
  <title>&susemgr; &productnumber3; Proxy Requirements</title>
  <para> The following section provides &susemgr; &productnumber3; Proxy requirements.</para>

  <formalpara>
   <title>Supported Client Systems</title>
   <para>For supported clients and their requirements, see: </para>
  </formalpara>
  <para><xref linkend="mgr.supported.client.systems"/></para>

  <formalpara>
   <title>Hardware Requirements</title>
   <para>Hardware requirements highly depend on your usage scenario. When planning proxy
    environments, consider the amount of data you want to cache on your proxy. If your proxy should
    be a 1:1 mirror of your &susemgr;, the same amount of disk space is required. For specific
    hardware requirements see the following table. </para>
  </formalpara>

  <informaltable>
   <tgroup cols="2">
    <colspec colname="c1" colwidth="1*"/>
    <colspec colname="c2" colwidth="4*"/>
    <thead>
     <row>
      <entry>
       <para> Hardware </para>
      </entry>
      <entry>
       <para> Required </para>
      </entry>

     </row>
    </thead>
    <tbody>
     <row>
      <entry>
       <para> CPU </para>
      </entry>
      <entry>
       <para> Multi-core 64bit CPU (x86_64). <remark>We need to test number of cores</remark></para>
      </entry>
     </row>
     <row>
      <entry>
       <para> RAM </para>
      </entry>
      <entry>
       <remark>Check to ensure these are the correct memory requirements with team</remark>
       <para> Minimum 4&nbsp;GB for a non-production server </para>
       <para> Minimum 16&nbsp;GB for a production server</para>
      </entry>
     </row>
     <row>
      <entry>
       <para> Free Disk Space </para>
      </entry>
      <entry>
       <para>Minimum 100&nbsp;GB for root partition </para>
       <para>Minimum 30&nbsp;GB for <filename>/var/lib/pgsql</filename></para>
       <para>Minimum 100&nbsp;GB for <filename>/var/spacewalk</filename></para>
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>

  <formalpara>
   <title>Additional Requirements</title>
   <para>For additional network requirements see:</para>
  </formalpara>
  <para><xref linkend="mgr.additional.requirements"/></para>
  <formalpara>
   <title>&scc;</title>
   <para>For using &susemgr; &productnumber3; Proxy, you need an account at &scc; (SCC) where your
    purchased products and product subscriptions are registered. Make sure you have the following
    subscriptions:</para>
  </formalpara>
  <itemizedlist>
   <listitem>
    <para> One or more subscriptions for &susemgrproxy;. </para>
   </listitem>
   <listitem>
    <para> One or more subscriptions for &susemgr;. </para>
   </listitem>
   <listitem>
    <para> Subscriptions for the products on the client systems you want to register with &susemgr;
     via &susemgrproxy;. </para>
   </listitem>
   <listitem>
    <para> Subscriptions to client entitlements for the client system you want to register with
     &susemgr; via &susemgrproxy;. </para>
   </listitem>
  </itemizedlist>


  <formalpara>
   <title>Network Time Protocol (NTP)</title>
   <para>The connection to the Web server via Secure Sockets Layer (SSL) requires correct time
    settings on the server, proxy and clients. For this reason, all systems must use NTP. See:
   </para>
  </formalpara>
  <para><link
    xlink:href="https://www.suse.com/documentation/sles-12/book_sle_admin/data/cha_netz_xntp.html"/>
  </para>
  <formalpara>
   <title>Virtual Environments</title>
   <para> The following virtual environments are supported: </para>
  </formalpara>


  <para><link xlink:href="http://www.linux-kvm.org/page/Main_Page"/></para>

  <para>
   <link xlink:href="http://www.vmware.com/"/></para>

  <para><link xlink:href="http://www.microsoft.com/en-us/server-cloud/solutions/virtualization.aspx"
   /></para>



  <para>For running &susemgrproxy; in virtual environments, use the following settings for the
   virtual machine (VM):</para>

  <itemizedlist>
   <listitem>
    <para> At least 1 GB of RAM </para>
   </listitem>
   <listitem>
    <para> Bridged network </para>
   </listitem>
  </itemizedlist>
 </sect1>

 <sect1 xml:id="at.manager.proxy.inst">
  <title>Installation and Setup</title>

  <para> Installing a &susemgr; &productnumber3; Proxy system has been simplified in &susemgr; 3.
   The following section will guide you through this procedure. </para>

  <procedure xml:id="at.manager.proxy.install.prep">
   <title>Creating Your First Proxy</title>
   <step>
    <para>Create an activation key based on the &sle; 12 SP1 base channel and ensure you have
     selected the child SUSE Manager Proxy channel which is required for providing the proxy
     packages. See: <xref linkend="create.act.keys"/></para>
    <figure>
     <title>Proxy Activation Key</title>
     <mediaobject>
      <imageobject>
       <imagedata fileref="proxy-key.png" width="80%"/>
      </imageobject>
     </mediaobject>
    </figure>
    <figure>
     <title>Base and Child Proxy Channel</title>
     <mediaobject>
      <imageobject>
       <imagedata fileref="sles12-proxy-child.png" width="80%"/>
      </imageobject>
     </mediaobject>
    </figure>

   </step>
   <step>
    <para>Modify a bootstrap script for the proxy and register it with &susemgr; using the new
     activation key. See: <xref linkend="modify.bootstrap.script"/>
    </para>
   </step>

   <step>
    <para>Once you have registered your client, direct your browser to the &susemgr; WebUI and
     login.</para>
   </step>

   <step>
    <para>Select the <systemitem>Systems</systemitem> tab and click on your newly registered &sle;
     12 SP1 client system from the <systemitem>Systems Overview</systemitem> table.</para>
   </step>

   <step>
    <para>On the system's detail page select the <guimenu>Software</guimenu> tab then
      <guimenu>Software Channels</guimenu> tab.</para>
   </step>

   <step>
    <para>You will see a list of channels to which your client is already subscribed to. Select the
     two unchecked proxy channels which include the <systemitem>SUSE Manager
      Proxy-3.0-POOL</systemitem> and <systemitem>SUSE-Manager-Proxy-3.0-Updates</systemitem> then
     select <guibutton>Change Subscriptions</guibutton> to continue. This will provide the required
     repositories for the proxy packages from the &susemgr; Server to the client.</para>
   </step>

   <step>
    <para>Select the <guimenu>Software</guimenu>, <guimenu>Packages</guimenu> tab and then
      <guibutton>Install New Packages</guibutton>.</para>
   </step>

   <step>
    <para>Type <filename>patterns</filename> within the search field on the <guimenu>Installable
      Packages</guimenu> page. Select the Proxy pattern and then select <guibutton>Install Selected
      Packages</guibutton>.</para>
   </step>
   <step>
    <para>On the <guimenu>Confirm Package Install</guimenu> page select confirm to schedule the
     installation.</para>
   </step>

  </procedure>
  <para>The Proxy pattern will be installed and the client will be upgrade to a &susemgrproxy;. You
   may then register your clients against the proxy using a bootstrap script as if it were a
   &susemgr; Server.</para>
 </sect1>



 <sect1 xml:id="sec.manager.proxy.migrating">
  <title>Migrating from &susemgrproxy; 2.1 to &susemgr; &productnumber3; Proxy</title>
  <para>THIS SECTION IN DEVELOPMENT</para>
 </sect1>

 <sect1 xml:id="at.manager.proxy.register.clients">
  <title>Registering Clients via &susemgrproxy;</title>

  <para> Registering clients via &susemgrproxy; is done almost the same way as registering clients
   directly with the &susemgr; server. The difference is that you create a bootstrap script on the
   &susemgrproxy; with a command-line tool. The bootstrap script then deploys all necessary
   information to the clients. The bootstrap script refers some parameters (such as activation keys
   or GPG keys) that depend on your specific setup. For background information, see the
   &mgrclientconfguide;. </para>

  <procedure>
   <step>
    <para> Create a client activation key on the &susemgr; server using the WebUI. See: <xref
      linkend="create.act.keys"/>
    </para>
   </step>
   <step>
    <para> On the proxy, execute the <command>mgr-bootstrap</command> command-line tool as
     &rootuser;. If needed, either edit the resulting bootstrap script or use additional
     command-line switches such as <literal>--activation-keys</literal>: </para>
    <screen>mgr-bootstrap \
  --activation-keys=<replaceable>key-string</replaceable></screen>
   </step>
   <step>
    <para> Execute the bootstrap script on the clients as described in </para>
   </step>
  </procedure>

  <para> The clients are registered with the &susemgrproxy; specified in the bootstrap
   script.</para>
 </sect1>

 <sect1>
  <title>Running configure-proxy.sh</title>
  <para>The configure-proxy.sh script will finalize setup of your &susemgr; proxy.</para>

  <para>On the proxy, log in as root and execute the interactive
    <filename>configure-proxy.sh</filename> script; answer questions about SUSE Manager Parent, CA
   Chain, Proxy version, Trace back email, Use SSL, HTTP Proxy, and provide input for an SSL
   certificate. A SUSE Manager Parent can be either another proxy server or a SUSE Manager server.
   Configuration input for monitoring follows. Next steps are CA password, whether to create and
   populate the configuration channel, and the credentials of the SUSE Manager server (user name and
   password).</para>

  <para>If parts are missing, such as CA key and public certificate, the script prints commands that
   you must execute to integrate the needed files. When the mandatory files are copied, re-run
    <filename>configure-proxy.sh</filename>.</para>

  <para><filename>configure-proxy.sh</filename> activates services required by SUSE Manager Proxy,
   such as squid, apache2, and jabberd.</para>

  <para>To check the status of the proxy system and its clients, click the proxy system's details
   page on the Web interface (Systems+Proxy, then the system name). Connection and Proxy subtabs
   display the respective status information</para>
 </sect1>

</chapter>
