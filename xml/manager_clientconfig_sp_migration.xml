<?xml version="1.0"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:novdoc-profile.xsl" 
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE chapter PUBLIC
  "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter id="ch-sp-migration">
 <title>Service Pack Migration</title><indexterm>
 <primary>service pack</primary>
 <secondary>migration</secondary></indexterm><indexterm>
 <primary>migration</primary>
 <secondary>service pack</secondary></indexterm>
 <para>
  Service Pack Migration (SP Migration) means <quote>migrating</quote> a
  system from one service pack level to the next consecutive level.
  Supported migration paths include:
 </para>

    <itemizedlist>
     <listitem>
      <para>
       SLES 11 SP1 → SLES 11 SP2 → SLES 11 SP3
      </para>
     </listitem>
     <listitem>
      <para>
       SLE 10 SP2 → SLE 10 SP3 → SLE 10 SP4
      </para>
     </listitem>
     <listitem>
      <para>
       &susemgrproxy; 1.2 → &susemgrproxy; 1.7 → &susemgrproxy; 2.1
      </para>
     </listitem>
    </itemizedlist>
    <para>
     &suse; only supports one step at a time. It is not
     possible to skip a SP and migrate from e.g., SP1 to SP3.
     The migration from SLE 10 SP4 to SLES 11 GA or SLES 11 SP1 is
     unsupported.
    </para>

    <note>
     <title>Limitation</title>
     <para>
      Currently it is only possible to schedule migrations for single systems.
     </para>
    </note>

    <para>
     Migrating add-on products is generally supported in one step:
    </para>

    <itemizedlist>
     <listitem>
      <para>
       SLES 11 SP2 + HA Extension SP2 → SLES 11 SP3 + HA Extension SP3
      </para>
     </listitem>
    </itemizedlist>

    <warning>
     <!-- bnc#844241 -->
     <title>Rollback Not Possible</title>
     <para>
      The migration feature does not cover any rollback functionality.
      Once the migration procedure is started, rolling back is not
      possible. Therefore it is recommended to have a working system
      backup available for emergencies.
     </para>
    </warning>

    <note>
     <!-- bsc#913215 -->
     <title>Using Slave Server Setup (Inter-Server Synchronization) for
     SP Migration</title>
     <para>
      Now (2015) it is possible to use a slave server setup for SP
      migration for connected clients, if all mandatory channels down to
      the vendor channel are synchronized to the slave server.  This is
      a hard requirement.
     </para>
     <para>
      For example, if you cloned <quote>Vendor</quote> as
      <quote>Test</quote> and then as <quote>Production</quote>
      (<quote>Vendor</quote> → <quote>Test</quote> →
      <quote>Production</quote>) only synchronizing the
      <quote>Production</quote> channel to the slave slave is not
      enough. To be able to use the Web Interface for a SP migration
      process it is required to synchronize also <quote>Vendor</quote>
      and <quote>Test</quote>.
     </para>
     <para>
      For more information about inter-server synchronization (ISS), see
      <xref linkend="ch-import-sync"/>.
     </para>
    </note>

    <procedure>
     <title>Service Pack Client Migration</title>
     <step>
      <para>
       To perform a SP migration, log in to the &susemgr; Web interface,
       click <guimenu>Systems</guimenu>, select a system, then click
       <menuchoice> <guimenu>Software</guimenu>
       <guimenu>SP Migration</guimenu></menuchoice> as described in
       <xref linkend="s5-sm-system-details-sp-migration"/>.
      </para>
     </step>
     <step>
       <para>Perform some preliminary steps:</para>
      <substeps>
       <step>
      <para>
       If &susemgr; now warns about channels mandatory for the
       migration as in <xref
       linkend="fig.sp-migration.warning.channels"/>, run the
       synchronization commands as indicated; for example:<remark role="needinfo">emap 2014-05-02: change sp2 to sp3 or keep it as a general example?</remark>
      </para>
      <screen>mgr-ncc-sync -c sles11-sp2-core-x86_64
mgr-ncc-sync -c sles11-sp2-extension-store-x86_64
mgr-ncc-sync -c sles11-sp2-suse-manager-tools-x86_64
mgr-ncc-sync -c sles11-sp2-updates-x86_64</screen>
    <figure id="fig.sp-migration.warning.channels">
     <title>Warning about Channels Mandatory for Migration</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="susemanager_software-sp-migration-warning.png" width="95%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="susemanager_software-sp-migration-warning.png" width="75%"/>
      </imageobject>
     </mediaobject>
    </figure>
       </step>
       <step>
         <para>
          If you intend to migrate to a set of cloned channels, all of
          the child channels need to be cloned for the target
          product. Otherwise the set of cloned channels will not be
          displayed as a migration target. For clones you can
          determine the content. Empty channels are valid. For further
          information on cloning channels, refer to <xref
          linkend="s2-sm-channel-manage"/>.
         </para>
       </step>
       <step>
        <!-- bnc#798342 -->
        <para>
         To update product information and database schema definitions, run:
        </para>
        <screen>mgr-ncc-sync --refresh</screen>
        <para>
         The explicit <option>refresh</option> is not needed, if you
         have configured a cronjob for the refresh and wait until the
         system will have executed it.
        </para>
       </step>
       <step>
    <para>
     Then click <guimenu>SP Migration</guimenu> again, and you will
     see a service pack migration overview listing installed and
     target products, a selection list for the target base channel, as
     well as mandatory and optional child channels. All channels of
     your service pack migration target will appear in the listings as
     in <xref linkend="fig.sp-migration.overview"/>.
    </para>
    <figure id="fig.sp-migration.overview">
     <title>Migration Overview</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="susemanager_software-sp-migration-overview.png" width="95%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="susemanager_software-sp-migration-overview.png" width="75%"/>
      </imageobject>
     </mediaobject>
    </figure>
     </step>
      </substeps>
     </step>
     <step>
      <para>
       (optional) On the <guimenu>Optional Child Channels</guimenu> page,
       activate all channels that are still required.
      </para>
     </step>
     <step>
      <para>
       Click <guimenu>Schedule Migration</guimenu> to continue with the
       migration process.  The next step will be the confirmation
       dialog&mdash;see <xref linkend="fig.sp-migration.confirm"/>.
    </para>
    <figure id="fig.sp-migration.confirm">
     <title>Migration Confirmation</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="susemanager_software-sp-migration-confirm.png" width="95%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="susemanager_software-sp-migration-confirm.png" width="75%"/>
      </imageobject>
     </mediaobject>
    </figure>
     </step>
     <step>
      <para>
       In the confirmation dialog you can specify the time for the
       action (service pack migration) and then continue with
       <guimenu>confirm</guimenu>.
      </para>
    <warning>
     <!-- bnc#851076 -->
     <title>Always use <guimenu>Dry Run</guimenu></title>
      <para>
       Click <guimenu>Dry Run</guimenu> to test the service pack
       migration on the desired machines and check the results. The
       Dry Run feature simulated what would happen during the actual
       migration and is useful to catch repository and package
       dependency errors. A failed service pack migration can render a
       machine unstable or inoperable, depending on when the migration
       stops. If you are confident that it will succeed, click the
       <guimenu>Confirm</guimenu> button.
      </para>
    </warning>
      <para>
       After clicking <guimenu>confirm</guimenu> a message appears on the top, announcing that
       the migration is scheduled&mdash;see <xref
       linkend="fig.sp-migration.scheduled"/>.
      </para>

    <figure id="fig.sp-migration.scheduled">
     <title>Migration Scheduled</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="susemanager_software-sp-migration-scheduled.png" width="95%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="susemanager_software-sp-migration-scheduled.png" width="75%"/>
      </imageobject>
     </mediaobject>
    </figure>
     </step>
    </procedure>
    <warning>
     <para>
      Any licenses (EULAs) are automatically accepted before a package is installed or updated.
     </para>
    </warning>
    <para>
     You can also find the properly scheduled service pack migration as
     a pending action by clicking on the <guimenu>Schedule</guimenu>
     tab&mdash;see <xref linkend="fig.sp-migration.schedule.tab"/> and
     <xref linkend="s1-sm-actions"/> for more information.
    </para>
    <figure id="fig.sp-migration.schedule.tab">
     <title>Schedule Tab with listed Service Pack Migration</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="susemanager_software-sp-migration-schedule-tab.png" width="95%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="susemanager_software-sp-migration-schedule-tab.png" width="75%"/>
      </imageobject>
     </mediaobject>
    </figure>

    <!-- https://bugzilla.suse.com/show_bug.cgi?id=920369 -->
    <note>
     <title>Service Pack Migration Related API Calls</title>
     <para>
      There are now (2015) the two API calls
      <literal>scheduleSPMigration</literal> and
      <literal>scheduleDistUpgrade</literal> that help with SP
      migration.  These calls are very powerful and must not be used
      without special caution.  For more information, see the API
      Documentation (in the WebUI, click
      <menuchoice><guimenu>Help</guimenu><guimenu>API</guimenu></menuchoice>).
     </para>
    </note>
</chapter>
