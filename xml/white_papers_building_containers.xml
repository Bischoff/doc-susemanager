<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook50-profile.xsl"
                 type="text/xml" 
                 title="Profiling step"?>

<!DOCTYPE chapter[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
    xml:id="white.papers.building.containers">

    <title>Building Containers</title>

    <sect1>
        <title>Introduction</title>
        <para>SUSE Manager enables system administrators to build containers, create Image stores,
            and profiles. The following sections provide guidance on using these new
            features.</para>

    </sect1>

    <sect1>
        <title>Requirements</title>
        <para>This feature is only available for SALT minions running on SLES12.</para>

    </sect1>

    <sect1>
        <title>Creating a Build Host</title>

        <para>To build container images with SUSE Manager, you will need to create a build host.
            Build hosts must be a Salt minion running SLES12.</para>
        <note>
            <para>During Beta phase you need to create a custom repository with the new client
                tools.</para>
        </note>

        <para>From the SUSE Manager WebUI perform the following steps to create a build host.</para>
        <procedure>
            <step>
                <para>Select the desired minion from the <guimenu>Systems Overview</guimenu>
                    page.</para>
            </step>
            <step>
                <para>From the <guimenu>System Details</guimenu> page assign the betatest client
                    tools channel to the minion by going to: <menuchoice>
                        <guimenu>Software</guimenu>
                        <guimenu>Software Channels</guimenu>
                    </menuchoice></para>
            </step>
            <step>
                <para>From the <guimenu>System Details</guimenu> page assign the containers modules
                    to the Salt minion by going to: <menuchoice>
                        <guimenu>Software</guimenu>
                        <guimenu>Software Channels</guimenu>
                    </menuchoice></para>
            </step>
            <step>
                <para>Update the "salt" and "salt-minion" packages.</para>
                <warning><para>Do not update Salt itself using Salt states. First update your other system packages using
                        salt states then update Salt as a separate stand-alone step from the SUSE
                        Manager WebUI.</para></warning>
            </step>
            <step>
                <para>From the <menuchoice>
                        <guimenu>System Details</guimenu>
                        <guimenu>Properties</guimenu>
                    </menuchoice> page, enable the Add-on System Type: <filename>Docker Build
                        Host</filename> then select <guimenu>Update Properties</guimenu></para>
            </step>
            <step>
                <para>A state will be applied that installs the required packages.</para>
            </step>
            
        </procedure>
    </sect1>
    
    <sect1>
        <title>Define Container Build Channels with an Activation Key</title>
        <para>Create an <literal>Activation Key</literal> associated with the channel that should be used with your image.</para>
        <procedure>
            <step><para>From the left navigation menu select <guimenu>Systems</guimenu><guimenu>Activation Keys</guimenu></para></step>
            <step><para>Select <guimenu>Create Key</guimenu>.</para></step>
            <step><para>Enter a <literal>Description</literal>, a <literal>Key</literal> name, Use the dropdown to select the <literal>Base Channel</literal> that should be associated with this Key.</para></step>
            <step><para>Make sure </para></step>
        </procedure>
    </sect1>

    <sect1>
        <title>Creating an Image Store</title>
        <para>When working with images you will need a place to store them. </para>
        <procedure>
            <step><para>From the left navigation menu select <guimenu>Images</guimenu> and <guimenu>Stores</guimenu>.</para></step>
            <step><para>Click <guimenu>Create</guimenu> to create a new store.</para></step>
            <step><para>Define the <literal>Store Type</literal>, currently this should be set to registry. Define a
                        <literal>Label</literal> and a <literal>URI</literal>(For containers the
                    FQDN is sufficient in most cases).</para></step>
            <step><para>Click <guimenu>Create</guimenu> to add the new <literal>Image Store</literal>.</para></step>
        </procedure>
    </sect1>


    <sect1>
        <title>Creating an Image Profile</title>
        <para/>

        <sect2>
            <title>Example Dockerfile</title>
            <para/>
        </sect2>
    </sect1>

    <sect1>
        <title>Building an Image</title>
        <para/>
    </sect1>

    <sect1>
        <title>Listing Available Build Images</title>
        <para/>
    </sect1>

    <sect1>
        <title>Troubleshooting</title>
        <para/>
    </sect1>

</chapter>
