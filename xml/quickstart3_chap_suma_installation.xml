<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:novdoc-profile.xsl" 
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE chapter PUBLIC
"-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter id="suma.installation.within.kvm">
    <title>&susemgr; &productnumber3; Installation With KVM</title>
    <sect1>
        <title>What's Covered Here?</title>

        <para> Installation has been greatly simplified as &susemgr; &productnumber3; may now be
            selected as an extension during installation of &sle; 12. This chapter provides
            instruction on getting started with &susemgr; in a simple test environment. A kernel
            virtual machine (KVM) combined with Virt Manager will be used as a safe testing ground
            for your first installation. The following sections will guide you through: </para>

        <itemizedlist>
           <listitem><para>Configuring (KVM) for a &sle; 12 installation using PXE boot</para></listitem> 
            <listitem>
                <para>Adding &susemgr; &productnumber3; to &sle; 12 as an extension
                </para>
            </listitem>
            <listitem><para>Completing the &sle; 12 installation</para></listitem>
            

        </itemizedlist>

        <important>
            <title>Prerequisites for this Guide</title>
            <para>This section assumes you have already reviewed the <link
                    linkend="suma3.overview.requirements">&susemgr; Overview and Requirements</link>
                section. </para>
        </important>
    </sect1>
    <sect1>
        <title>Preparing Your &susemgr; Playground</title>
        <para><remark>This section is for internal use and guides an employee unfamiliar with
                &susemgr; through installing SUMA3 from the internal development repositories using
                &sle; 12.</remark></para>

        <procedure>
            <title>Installation using Virtual Machine Manager</title>
            <step>
                <para>Create a new virtual machine with <systemitem>Virtual Machine
                        Manager</systemitem></para>
            </step>
            <step>
                <para>Within the <systemitem>New VM</systemitem> dialog box select
                        <systemitem>Network Boot (PXE)</systemitem>. </para>
                <figure>
                    <title>PXE Boot as the Installation Method</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-vmm-1.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <para>Select <systemitem>Forward</systemitem> to continue.</para>
            </step>
            <step>
                <para>For the operating system and Version choose <systemitem>Linux</systemitem> and
                        <systemitem>&sle; 12 (or later)</systemitem>. </para>
                <figure>
                    <title>OS and Version Selection</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-vmm-2.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <para>Select <systemitem>Forward</systemitem> to continue.</para>
            </step>
            <step>
                <para>On the next screen you will need to select the amount of memory and number of
                    CPU's you wish to make available for the Virtual Machine. For testing we
                    selected <systemitem>4096 MB</systemitem> ram and <systemitem>4</systemitem>
                    CPUs. </para>
                <figure>
                    <title>Selecting Ram Quantity and Number of CPUs</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-vmm-3.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <para>Select <systemitem>Forward</systemitem> to proceed.</para>
            </step>
            <step>
                <para>Select <systemitem>Managed or other existing storage</systemitem> and then
                    Browse. You need to create a storage device with enough space to fulfil
                    &susemgr; requirements. We will cover partitioning requirements within the
                    installation section.</para>
                <figure>
                    <title>Storage Selection: Managed or Existing</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-vmm-4.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>

            <step>
                <para>Next select <systemitem>New Volume</systemitem>.</para>
            </step>
            <step>
                <para>For this guide &susemgr; requires 180 GB for its partitions. Name your storage
                    volume and accept the default format of <systemitem>qcow2</systemitem>. Check
                    the <systemitem>Storage Volume Quota</systemitem> available space and ensure
                    your filesystem fulfils the 180 GB space requirement. Change the default vaule
                    of <systemitem>8.0 GB</systemitem> in the <systemitem>Max Capacity</systemitem>
                    field to 180 GB. </para>
                <figure>
                    <title>Adding a Storage Volume</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-vmm-5.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>


            <step>
                <para>Select <systemitem>Finish</systemitem> to proceed.</para>
            </step>
            <step>
                <para>Select <systemitem>Choose Volume</systemitem> to continue. At the following
                    dialog select <systemitem>Forward</systemitem> to continue.</para>
            </step>
            <step>
                <para>Name your virtual machine. </para>
                <figure>
                    <title>Naming Your Machine</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-vmm-7.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <para>Finally select <systemitem>Finish</systemitem> to finalize your virtual
                    machine setup.</para>
            </step>
        </procedure>
    </sect1>

    <sect1>
        <title>PXE Booting &sle; 12</title>
        <para>After completing VM setup in KVM the VM will automatically boot to the PXE boot menu.
            The following procedure will guide you through PXE boot. </para>

        <procedure>
            <title>PXE Boot Procedure</title>
            <step>
                <para>Select <systemitem>Unpacked SLE-12 ISOs via SLP</systemitem> to
                    continue.</para>
                <figure>
                    <title>PXE Boot Menu</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-pxeboot-sles12.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <para>Select <systemitem>SLE 12 SP1 Server LATEST x86_64 DVD1</systemitem></para>
                <figure>
                    <title>&sle; 12 ISO Selection Screen</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-pxeboot-sles12-2.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>

        </procedure>
    </sect1>

    <sect1>
        <title>&sle; 12 Installation Procedure</title>
        <procedure>
            <step>
                <para>Select your language and desired keyboard settings, you may change them if
                    necessary. You need to accept the license agreement by checking <systemitem>I
                        Agree to the License Terms</systemitem> to continue.</para>
                <figure>
                    <title>Language and Keyboard</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-sles12-1.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <para>Proceed with <systemitem>Next</systemitem> to continue. </para>
            </step>

            <step>
                <para>Enter the e-mail address associated with your (SCC) account and the
                    registration code for &sle; Server. A successful registration is a prerequisite
                    for getting product updates and being entitled to technical support. </para>
                <figure>
                    <title>Registration with (SCC)</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-sles12-2.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <para>Proceed with Next.</para>
            </step>

        </procedure>
        <note>
            <title>&susemgr; and Updating</title>
            <para>If &sle; Server has been successfully registered at (SCC) you will be asked if you
                would like to install the latest available online updates. Choosing
                    <systemitem>Yes</systemitem> provides the system with the most current updates
                and packages. If this option is selected, a manual update will be unnecessary after
                installation. These updates will also include the &susemgr; &productnumber3; updates
                if it was selected as an extension during installation.</para>
        </note>
        <para>The next section will continue by enabling the &susemgr; &productnumber3; extension
            within the &sle; 12 installation.</para>
    </sect1>

    <sect1>
        <title>Enabling &susemgr; &productnumber3; as an Extension</title>
        <remark>This section is currently blocked. The option to choose manager as an extension does
            not yet exist! The current screenshot is a placeholder and will need to be
            updated.</remark>
        <important>
            <title/>
            <para><remark>Ornela, follow the guide in the next procedure to add the devel suma3
                    extension. :) This step will never be used by our customers. </remark></para>
        </important>
        <remark/>
        <procedure>
            <title>Selecting &susemgr; as an Extension</title>
            <step>
                <para>Select &susemgr; &productnumber3; as an extension.</para>

                <figure>
                    <title>Extension and Module Selection</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-sles12-extensions1.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>

            </step>
            <step>
                <para>Click <systemitem>Next</systemitem> to continue.</para>
            </step>
        </procedure>

        <important>
            <para>Ornela, to add the Devel Extension for testing complete the following
                procedure.</para>
        </important>
        <procedure>
            <title>Adding the &susemgr; &productnumber3; Developer's Extension Preview</title>
            <step>
                <para>Select <systemitem>I would like to install an additional Add On
                        Product</systemitem>. Since you are working internally, you will need to
                    specify the URL leading to the &susemgr; &productnumber3; developer image
                    repository. </para>

                <figure>
                    <title>Add on Product</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-devel-ext1.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <para>Leave the default value of <systemitem>Specify URL...</systemitem> and click
                        <systemitem>Next</systemitem> to continue.</para>
            </step>

            <step>
                <para>On the <systemitem>Repository URL</systemitem> screen you need to name the
                    repository you will be adding and provide the URL to the developer repository.
                    Internal Up-to-date builds are found here: <ulink
                        url="http://dist.suse.de/ibs/Devel:/Galaxy:/Manager:/Head/images/repo/"
                        >Up-to-date &susemgr; Developer Builds</ulink> Select the latest build and
                    input the full URL including the latest build number.</para>
                <figure>
                    <title>Adding the Developer Repository</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-sles12-suma-repo.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <para>Click <systemitem>Next</systemitem> to continue.</para>

            </step>
            <step>
                <para>You will be prompted to trust the repository key. Select
                        <systemitem>Trust</systemitem>.</para>
            </step>
            <step>
                <para>At the following screen you will see the latest build has been added to your
                    list of repositories. Click <systemitem>Next</systemitem> to continue.</para>
                <figure>
                    <title/>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-addon-final.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
        </procedure>
    </sect1>

    <sect1>
        <title>Configuring &susemgr; &productnumber3; Storage</title>
        <para>This section introduces the critical topic of correctly configuring storage for use
            by &susemgr;.</para>
        <warning>
            <title>Space Requirements</title>
            <para>&sle; 12 defaults to 40 GiB for its base file system. &susemgr; requires 100+ GiB
                for channel mirror data mounted at <filename>/var/spacewalk</filename> and an
                additional 30+ GiB for its database mounted at <filename>/var/lib/pgsql</filename>.
                If these requirements are not met the installation of &susemgr; will fail. Review
                this section carefully to ensure you have properly configured the necessary
                partitions. </para>
        </warning>


        <para>This step of the installation guide starts at the <systemitem>Suggested Partitioning
            </systemitem> screen. You will now use the expert partitioner to configure the required
            directories and fullfil &susemgr;'s space requirements.</para>

        <procedure>
            <title>Suggested Partitioning</title>
            <step>
                <para>Select <systemitem>Expert Partitioner...</systemitem> to initiate the
                    partition tool.</para>

                <figure>
                    <title>Suggested Partitioning</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-partition1.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>

            <step>
                <para>In the Expert Partitioner you can find your virtual hard disk (vda) located on
                    the left under the <systemitem>System View</systemitem> panel. Choose
                        <systemitem>Hard Disks</systemitem>. The system has already created a
                    temporary scheme which we will change to suit &susemgr;'s needs.</para>
            </step>
            <step>
                <para>Select the top level (vda) located under <systemitem>Hard
                    Disks</systemitem>and you will see your current partitions displayed within the
                    Partitions tab to the right.</para>
            </step>

            <step>
                <para>Delete the <filename>root /</filename> and <filename>/home</filename>
                    partitions with the <systemitem>Delete</systemitem> button. If these partition
                    are not deleted you will not have enough space later during setup for the
                    required directories. </para>

            </step>
            <step>
                <para>Next click <systemitem>Add</systemitem> to add a new partition.</para>
            </step>
            <step>
                <para>Under <systemitem>New Partition Type</systemitem> select <systemitem>Primary
                        Partition</systemitem> then click <systemitem>Next</systemitem> to
                    continue.</para>
                <figure>
                    <title>Root Partition Type</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-root1.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <para>Leave the default <systemitem>New Partition Size</systemitem> to custom and
                    click <systemitem>Next</systemitem> to continue.</para>
                <figure>
                    <title>Root Partition Size</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-root2.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <step>
                <para>For the partitions role select <systemitem>Data and ISV
                        Applications</systemitem>. Continue with <systemitem>Next</systemitem>.
                </para>
            </step>
            <step>
                <para>Under <systemitem>Formatting Options</systemitem> select
                        <systemitem>BTrFS</systemitem> from the drop down menu. Click
                        <systemitem>Next</systemitem> to proceed. Your final setup should look like
                    the following example.</para>
                <figure>
                    <title>Completed Partition Setup</title>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="quickstart-root4.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>

            <step>
                <para>This concludes partition setup. Select <systemitem>Next</systemitem> to
                    continue.</para>
            </step>
        </procedure>
        <para>The next section covers the remaining steps required to complete the &sle; 12
            installation. </para>
    </sect1>

    <sect1>
        <title>Completing the &sle; 12 Installation</title>
        <procedure>
            <title>Completing Installation</title>
            <step>
                <para>You will now select your date and time zone. These settings are critical for
                    syncing with &scc;. Ensure your servers time matches that of your host machine.
                    Select <systemitem>Next</systemitem> to continue when the <systemitem>Date and
                        Time:</systemitem> field match that of your host system.</para>
            </step>
            <step>
                <para>Create a new user and password. You can optionally select to use the same
                    password for administrator. If this option remains unselected you will be prompted
                    to create a new root password at the following screen.</para>
            </step>
            <step>
                <para>At the <systemitem>Installation Settings</systemitem> screen you may alter any
                    of the optional settings required for your organization. For this guide the
                    firewall has been disabled to decrease complications. Select
                        <systemitem>Next</systemitem> to proceed.</para>
               
            </step>
            
        </procedure> <warning>
                    <title>Disabling the Firewall</title>
                    <para>Do not disable the firewall in a production environment!</para>
                </warning>
        <para>Installation will begin by installing &sle; 12, the &susemgr; &productnumber3; extension. If the update option was selected during installation the latest patches will be downloaded bringing your new system up-to-date. Grab a cup of coffee! This concludes the installation section of this guide.</para>
    </sect1>


</chapter>
