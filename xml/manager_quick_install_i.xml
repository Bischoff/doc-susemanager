<?xml version="1.0"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:novdoc-profile.xsl" 
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE sect1 PUBLIC
  "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<sect1 id="sec.manager.inst">
 <title>Installation and Setup</title>

 <para>
  &susemgr; is a management server application combined with an operating
  system (appliance). It can be deployed on industry hardware or in a virtual
  environment and used with an embedded or external database.
 </para>

 <note>
  <!-- adding pointer because of 
  http://doccomments.provo.novell.com/comments/21154 -->
  <title>Information about Using an External Database</title>
  <para>
   For information about setting up an external database, see <xref
   linkend="s1-requirements-database"/>.
  </para>
 </note>

 <!-- ke 2011-08-13: this is basically already said above.
     ke 2013-06-19: better (partially) repeat it here.
 -->
 <para>
  If your &susemgr; server is connected to the Internet, it will
  receive any updates directly from the NCC. For a disconnected setup
  scenario, configure &susemgr; to receive any updates from an internal
  update server (like &smt;) instead.
 </para>

 <para>
  The &yast; graphical user interface will guide you through the
  installation and the setup process. It is started in text mode. Use the
  <keycap function="tab"/> key to navigate among individual elements. To
  select a value from a list, use the <keycap function="up"/> and
  <keycap function="down"/> arrow keys and press <keycap function="enter"/>.
  To activate an option, press the <keycap function="space"/> key.
 </para>

 <sect2 id="sec.manager.inst.overview">
  <title>Overview and Summary of Steps</title>
<!--taroth 2011-01-25: keep in SYNC with Install Guide, file
  xml/manager_install_intro.xml, section id="s1-summary-steps"
    ke 2011-08-13: I think it isn't strictly needed to keep it in sync-->
  <para>
   The &mgrquick; covers the following installation and setup scenarios:
  </para>
<!--taroth 2011-2-14: bnc#671192-->
<!--taroth 2011-01-25: keep in SYNC with Install Guide, file
  xml/manager_install_intro.xml, section id="s1-summary-steps"-->
  <variablelist>
   <varlistentry>
    <term>Setup From Scratch&mdash;With Internet Connection</term>
    <listitem>
     <para>
      For installation and initial setup, you need to execute the following
      basic steps:
     </para>
     <orderedlist>
      <listitem>
       <para>
        If using a stand-alone database: Preparing your database instance
        according to the formula provided in
        <xref linkend="ch-requirements"/>.
       </para>
      </listitem>
      <listitem>
       <para>
        <xref linkend="pro.manager.installation" xrefstyle="select:title"/>
       </para>
      </listitem>
      <listitem>
       <para>
        <xref linkend="pro.manager.setup" xrefstyle="select:title"/>
       </para>
      </listitem>
     </orderedlist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Setup From Scratch&mdash;Without Internet Connection</term>
    <listitem>
     <para>
      For installation and initial setup, execute the same basic steps as
      listed above, but skip the registration of the product at NCC.
      <!-- refer directly to the SMT setup -->
      For details, refer to <xref linkend="s1-disconnected-setup"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Migration from a Satellite Server</term>
    <listitem>
     <para>
      Instead of setting up a &susemgr; server from scratch, you can also
      migrate from an existing Satellite server. For details, refer to
      <xref linkend="sec.manager.server.migration"/>.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 id="sec.manager.inst.installation">
  <title>Installation</title>
  <para>
   The following procedure describes the installation on a physical machine.
   Make sure the machine you intend to use fulfills the
   <xref linkend="sec.manager.requirements.server" xrefstyle="select: quotedtitle page"/>.
   If you want to install the appliance in a virtual machine, additionally
   check the settings listed in
   <xref linkend="vle.manager.req.virt" xrefstyle="select: quotedtitle page"/>.
  </para>
  <procedure id="pro.manager.installation">
   <title>Installing the Appliance</title>
   <warning>
    <title>Loss of Data</title>
    <para>
     Installing &susemgr; on a physical machine will completely erase any
     data on the hard disk that will be used for installation. Before you
     start the installation process, create a backup of your hard disks.
    </para>
   </warning>
   <step>
    <para>
     Boot your future &susemgr; server from the installation medium. Select
     <guimenu>Install/Restore &susemgr;</guimenu>.
    </para>
   </step>
   <step>
    <para>
     If your machine contains more than one hard disk, you are asked which
     one to use for the installation of &susemgr;. Navigate with the arrow
     keys, and use the space key to mark the desired hard disk. You are
     asked if you want to continue and you are warned that the installation
     will destroy all data on the disk.
    </para>
   </step>
   <step>
    <para>
     To proceed, answer with <guimenu>Yes</guimenu>. The deployment process
     takes over. This step may take some time as large amounts of data need
     to be unpacked and verified. After the verification, &yast; firstboot
     is started.
    </para>
   </step>
   <step>
    <para>
     In the first screen, set the system <guimenu>Language</guimenu> and
     <guimenu>Keyboard Layout</guimenu> for your future &susemgr; server.
     Proceed with <guimenu>Next</guimenu>.
    </para>
   </step>
   <step id="step.manager.install.root.pwd">
    <para>
     In the next screen, set the &rootuser; password for your &susemgr;
     server and confirm it.
    </para>
    <figure>
     <title>&yast; Firstboot&mdash;Password for the System Administrator</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="susemanager_firstboot_root_pwd.png" width="85%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="susemanager_firstboot_root_pwd.png" width="75%"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     Proceed with <guimenu>Next</guimenu>.
    </para>
   </step>
   <step>
    <para>
     In the next screen, read the licenses and agree to them. Proceed with
     <guimenu>Next</guimenu>. The installation routine checks some basic
     system requirements and depending on the results, lets you decide
     whether to proceed with the installation or cancel.
    </para>
   </step>
   <step>
    <para>
     In the next screen, configure the network settings. Note the network
     requirements listed in
     <xref linkend="sec.manager.requirements.other"/>. Either choose to
     <guimenu>Use Following Configuration</guimenu> or
     <guimenu>Change</guimenu> the network setup according to your wishes.
    </para>
    <figure>
     <title>&yast; Firstboot&mdash; Network Configuration</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="susemanager_firstboot_network.png" width="90%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="susemanager_firstboot_network.png" width="75%"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     Proceed with <guimenu>Next</guimenu>.
    </para>
   </step>
   <step>
    <para>
     In the next screen, configure the <guimenu>Clock and Time
     Zone</guimenu> to use for your &susemgr; server. Proceed with
     <guimenu>Next</guimenu>.
    </para>
   </step>
   <step>
    <para>
     In the next screen, configure the NTP settings according to your
     wishes. For more information about the options, refer to
     <guimenu>Help</guimenu>. Note the NTP requirements listed in
     <xref linkend="sec.manager.requirements.other"/>. Proceed with
     <guimenu>Next</guimenu>.
    </para>
   </step>
<!--https://bugzilla.novell.com/show_bug.cgi?id=664925#c8-->
   <step id="step.manager.install.register.ncc">
    <para>
     In the next screen, your are asked to register and activate your
     product at NCC. During registration, the respective online update
     repositories are automatically configured.
    </para>
    <important>
     <title>NCC Registration and Updates</title>
     <para>
      Proper registration is mandatory for the system to receive updates and
      to ensure that any known installation problems are fixed. In case of a
      disconnected &susemgr; setup, skip this step by selecting
      <guimenu>Configure Later</guimenu>.
     </para>
    </important>
    <figure>
     <title>&yast; Firstboot&mdash;NCC Configuration</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="susemanager_firstboot_ncc.png" width="80%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="susemanager_firstboot_ncc.png" width="75%"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     If you decide to <guimenu>Configure Later</guimenu>, you can
     call the respective &yast; module on the &susemgr; server with the
     <command>yast&nbsp;inst_suse_register</command> command any time.
    </para>
    <para>
     If you need to check the registration status of your &susemgr;, use the <command>isRegistered</command> command on the server. If the system is registered, more detailed information is available in the <filename>/var/lib/suseRegister/registration-status.xml</filename> file.
    </para>
    <para>
     To register directly:
    </para>
    <substeps>
     <step>
      <para>
       Select <guimenu>Configure Now (Recommended)</guimenu>.
      </para>
     </step>
     <step>
      <para>
       Confirm that you want to continue. A text-based browser (w3m)
       appears. Use the <keycap function="tab"/> key or the arrow keys to
       navigate among individual elements. To enter data into an input
       field, activate text input mode by pressing the
       <keycap function="enter"/> key once, then enter the value and press
       <keycap function="enter"/> again to confirm.
      </para>
     </step>
     <step>
      <para>
       After all values are entered according to your wishes,
       <guimenu>Submit</guimenu> your input and press
       <keycombo><keycap function="shift"/><keycap>Q</keycap></keycombo> to
       close the text-based browser.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     On the <guimenu>Installation Completed</guimenu> screen, select
     <guimenu>Finish</guimenu> to close &yast; firstboot. The boot process
     continues.
    </para>
   </step>
   <step>
    <para>
     Wait for the boot process to finish.
<!--When the login prompt appears on
    the console, write down the hostname listed there&mdash;you will need it to
    access the &susemgr; Web interface later. -->
    </para>
    <important>
     <title>&susemgr; Update Required</title>
     <para>
      After installation, update your &susemgr; server to apply the latest
      patches before starting the setup process. To receive updates,
      registration at NCC (or a connection to an internal update server like
      &smt;) is required. For details on how to execute the update, refer to
      <xref linkend="pup-sle"/>.
     </para>
    </important>
   </step>
  </procedure>
 </sect2>

 <sect2 id="sec.manager.inst.setup">
  <title>Setup</title>
  <para>
   After running &yast; firstboot and updating &susemgr; server, run a
   setup script via &yast;. It will display several consecutive
   screens to configure the basic data for setup and the database
   connection. Enter a value in each input field, otherwise the setup
   may fail.
  </para>
  <para>
   In the setup screens, you will also be prompted for two passwords.
  </para>
  <note>
   <title>Password Criteria</title>
   <para>
    Both passwords must match the following criteria (otherwise the
    connection to the database or the creation of the certificate might
    fail):
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Length: At least 7 characters.
     </para>
    </listitem>
    <listitem>
     <para>
      Special characters: Must not contain any of the following characters:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Spaces
       </para>
      </listitem>
      <listitem>
       <para>
        Quotation marks (neither <literal>"</literal> nor
        <literal>'</literal>)
       </para>
      </listitem>
      <listitem>
       <para>
        Exclamation marks (<literal>!</literal>)
       </para>
      </listitem>
      <listitem>
       <para>
        Dollar symbols (<literal>$</literal>)
       </para>
      </listitem>
     </itemizedlist>
    </listitem>
   </itemizedlist>
  </note>
  <procedure id="pro.manager.setup">
   <title>Setting Up &susemgr;</title>
   <step>
    <para>
     Log in to the machine as &rootuser; with the password you set during
     the installation in <xref linkend="step.manager.install.root.pwd"/>.
    </para>
   </step>
   <step>
    <para>
     Execute <command>yast2&nbsp;susemanager_setup</command> to start the
     setup process.
    </para>
   </step>
   <step>
    <para>
     The first setup screen lets you choose between setting up &susemgr;
     from scratch and migrating to &susemgr; from a Satellite/Spacewalk
     compatible server. Choose <guimenu>Set up &susemgr; from
     scratch</guimenu>. Proceed with <guimenu>Next</guimenu>.
    </para>
    <figure>
     <title>Setup&mdash;Type</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="susemanager_setup_type.png" width="80%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="susemanager_setup_type.png" width="75%"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     In the next setup screen, enter an email address for the
     &susemgr; administrator. It is used for notifications by
     &susemgr; and is associated with the SSL certificate to be
     created in the next step. In the same dialogue, decide whether
     &susemgr; should advertise its services via SLP under the name
     <literal>susemanager</literal>. Clients can then find the closest
     &susemgr; server to connect to. Proceed with
     <guimenu>Next</guimenu>.
    </para>
   </step>
   <step>
    <para>
     In the next setup screen, enter the details needed for the creation of
     an SSL certificate. The certificate is used for a number of purposes
     like connections to a proxy, HTTPS protocol in browsers, and more.
    </para>
    <substeps>
     <step id="step.manager.setup.org">
      <para>
       Enter the name of your organization, the organization unit, and the
       city, state and country that your &susemgr; server is located in. The
       <guimenu>Organization</guimenu> name defines the name of the default
       administrative organization that is automatically created during
       setup.
      </para>
     </step>
     <step>
      <para>
       Set an SSL (Secure Sockets Layer) password and repeat it in the next
       field.
      </para>
      <figure>
       <title>Setup&mdash;Certificate</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="susemanager_setup_cert.png" width="90%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="susemanager_setup_cert.png" width="75%"/>
        </imageobject>
       </mediaobject>
      </figure>
      <para>
       Proceed with <guimenu>Next</guimenu>.
      </para>
     </step>
    </substeps>
   </step>
   <step id="st.manager.install.server-and-database">
    <para>
     In the next setup screen, set the details for the setup of the server
     and the database:
    </para>
    <substeps>
     <step>
      <para>
       Decide whether to use the embedded (local) or a remote database for
       &susemgr;.
      </para>
      <para>
       If you select <guimenu>Local Database</guimenu>, &yast; automatically
       sets the <guimenu>Port</guimenu> and <guimenu>Protocol</guimenu>.
      </para>
      <para>
       To use an existing, remote database instead, select <guimenu>Remote
       Database</guimenu> and enter the following details for the connection
       to the database: the database system (SID) used to identify a
       particular database instance, the FQDN of the remote database, the
       external <guimenu>Port</guimenu> to use (usually
       <literal>1521</literal>), and the <guimenu>Protocol</guimenu> to use
       (usually <literal>TCP</literal>).
      </para>
     </step>
     <step>
      <para>
       If you use the embedded database, set a user name and a password for
       the &susemgr; database user (that is used to connect to the
       database).
      </para>
      <para>
       For a remote database, enter a user name that already exists in the
       database configuration, and enter the correct password for this user.
       Otherwise the connection to the database will fail.
      </para>
     </step>
     <step>
      <para>
<!-- bwiedemann 20110210:  is this needed for remote DB account (where it does not make sense), too? -->
       Repeat the password in the next field.
      </para>
      <figure>
       <title>Setup&mdash;Local Database</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="susemanager_setup_db.png" width="90%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="susemanager_setup_db.png" width="75%"/>
        </imageobject>
       </mediaobject>
      </figure>
      <para>
       Proceed with <guimenu>Next</guimenu>.
      </para>
     </step>
    </substeps>
   </step>
<!--taroth 2011-02-09: IP address no longer needed (=already set during
   firstboot procedure   
   <step> 
    <para> Enter the IP address of the &susemgr; server. By default, the
      setup script inserts the IP address of your machine taken from your DHCP
      server. </para>
    </step>-->
<!--  taroth 2011-01-24: seems this option is no longer present: <step>
     <para>
      Keep TFTP (trivial file transfer protocol) enabled. Its default value
      is <literal>y</literal>. If you set it to <literal>n</literal>, remote
      network booting via PXE (Preboot eXecution Environment) will not work.
     </para>
    </step>-->
   <step>
    <para>
     The last setup screen asks for your mirror credentials from the
     NCC.  Select <guimenu>Connect to NCC</guimenu> and enter your
     <guimenu>NCC Mirror Credentials Username</guimenu>, the
     <guimenu>NCC Mirror Credentials Password</guimenu>), and your
     <guimenu>NCC E-mail Address</guimenu>.
    </para>
    <figure>
     <title>Setup&mdash;NCC Settings</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="susemanager_setup_ncc.png" width="95%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="susemanager_setup_ncc.png" width="75%"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step id="step.manager.show.hostname">
    <para>
     Proceed with <guimenu>Next</guimenu> and confirm with
     <guimenu>Yes</guimenu> to start the setup.
    </para>
    <note>
     <title>Long Operation</title>
     <para>
      This step may take some time. Wait until the <guimenu>Setup is
      completed</guimenu> message appears in the upper part of the &yast;
      screen.
     </para>
    </note>
   </step>
   <step>
    <para>
     Click <guimenu>Next</guimenu> and read the instructions about the next
     steps. Close &yast; by pressing <guimenu>Finish</guimenu>.
    </para>
   </step>
  </procedure>
  <para>
   The basic &susemgr; settings are written to
   <filename>/etc/rhn/rhn.conf</filename>. If you have chosen to use a local
   database, the initial database is created and populated. If you have
   chosen to use a remote database, the setup script connects to the
   database.
  </para>
  <para>
   The setup script also runs the
   <filename>/usr/sbin/mgr-ncc-sync</filename> command which downloads the
   subscriptions listed in your NCC Mirror Credentials. The respective
   <guimenu>Software Channel Entitlements</guimenu> will be listed in the
   &susemgr; Web interface (select
   <menuchoice><guimenu>Admin</guimenu><guimenu>Subscriptions</guimenu></menuchoice>).
  </para>
  <para>
   To switch from a trial license to a full license, repeat server registration with the new registration key (or keys, in case more than one applies), with the following command after replacing <replaceable>EMAIL_ADDRESS</replaceable> and <replaceable>REGISTRATION_CODE</replaceable> with appropriate values:</para>
   <screen>
    suse_register -a email=EMAIL_ADDRESS -a regcode-sms=REGISTRATION_CODE
   </screen>
  <para>
   Then refresh &susemgr; channels to reflect the new entitlements
   with the <command>mgr-ncc-sync -r</command> command.
  </para>
  <tip>
   <!-- bnc#785462 -->
   <title>Running &susemgr; Behind an HTTP Proxy</title>
   <para>
    If <command>mgr-ncc-sync</command> fails, because you are running
    the &susemgr; server behind an HTTP proxy configured with &yast;,
    check in the Web interface whether the proxy is actually known to
    &susemgr;.  For more information, see <xref
    linkend="s3-sattools-config-gen" />.
   </para>
  </tip>

  <note>
   <!-- bnc#793700 -->
   <title>Accessing NCC <literal>nu.novell.com</literal></title>
   <para>
    <literal>nu.novell.com</literal> uses proxy technologies to provide
    a fast download service world-wide.  Depending on the location, the
    real hostname and the IP address is different.
   </para>
   <para>
    To correctly setup company firewalls, to allow access to the repositories,
    check which proxy you are using with the following command:
   </para>
   <screen>nslookup nu.novell.com</screen>
  </note>

 </sect2>

<!--<figure>
  <title>Installation and Setup Complete</title>
  <mediaobject>
   <imageobject role="fo">
    <imagedata fileref="susemanager_setup_ready.png" width="75%" format="PNG"/>
   </imageobject>
   <imageobject role="html">
    <imagedata fileref="susemanager_setup_ready.png" width="75%" format="PNG"/>
   </imageobject>
  </mediaobject>
 </figure>-->
</sect1>
