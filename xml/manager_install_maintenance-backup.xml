<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:novdoc-profile.xsl" 
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE sect1 PUBLIC
  "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>

<sect1 id="s1-maintenance-backup">
    <!--status="rfc"-->
    <title>Backing Up &susemgr;</title>
    <indexterm>
        <primary>backing up &susemgr;</primary></indexterm>
    
    <para>
        Backing up &susemgr; can be done in several ways. Regardless of the
        method chosen, the associated database also needs to be backed up. For
        the stand-alone database, consult your organization's database
        administrator. For the embedded database, refer to
        <xref linkend="s1-config-smdb"/> for a complete description of this
        process and the options available.
    </para>
    
    <para>
        &suse; recommends backing up the following files and directories:
    </para>
    
    <remark condition="clarity">
        2011-02-02 - fs: Are all the file/directory names correct?
    </remark>
    
    <itemizedlist>
        <listitem>
            <para>
                <filename>/rhnsat/</filename> &mdash; embedded database only (never to be
                backed up while the database is running<!--; refer to
                <xref linkend="s2-rhn-db-control-backup"/>-->)
            </para>
        </listitem>
        <listitem>
            <para>
                <filename>/etc/sysconfig/rhn/</filename>
            </para>
        </listitem>
        <listitem>
            <para>
                <filename>/etc/rhn/</filename>
            </para>
        </listitem>
        <listitem>
            <para>
                <filename>/etc/sudoers</filename>
            </para>
        </listitem>
        <listitem>
            <para>
                <filename>/etc/tnsnames.ora</filename>
            </para>
        </listitem>
        <listitem>
            <para>
                <filename>/srv/www/htdocs/pub/</filename>
            </para>
        </listitem>
        <listitem>
            <para>
                <filename>/var/spacewalk/packages/1</filename> &mdash; custom RPMs
            </para>
        </listitem>
        <listitem>
            <para>
                <filename>/root/.gnupg/</filename>
            </para>
        </listitem>
        <listitem>
            <para>
                <filename>/root/ssl-build/</filename>
            </para>
        </listitem>
        <listitem>
            <para>
                <filename>/etc/dhcp.conf</filename>
            </para>
        </listitem>
        <listitem>
            <para>
                <filename>/tftpboot/</filename>
            </para>
        </listitem>
        <listitem>
            <para>
                <filename>/var/lib/cobbler/</filename>
            </para>
        </listitem>
        <listitem>
            <para>
                <filename>/var/lib/rhn/kickstarts/</filename>
            </para>
        </listitem>
        <listitem>
            <para>
                <filename>/srv/www/cobbler</filename>
            </para>
        </listitem>
        <listitem>
            <para>
                <filename>/var/lib/nocpulse/</filename>
            </para>
        </listitem>
    </itemizedlist>
    
    <para>
        &suse; recommends to back up the entire
        <filename>/var/spacewalk/</filename> tree. In case of failure, this
        will save lengthy download time. Since
        <filename>/var/spacewalk/</filename> (specifically
        <filename>/var/spacewalk/packages/NULL/</filename>) is primarily a
        duplicate of the package repository, it can be regenerated with
        <filename>mgr-ncc-sync</filename>.  In the case of disconnected
        &susemgr;s,
        <filename>/var/spacewalk/</filename><emphasis>must</emphasis> be
        backed up.
    </para>
    
    <remark condition="clarity">
        2011-02-02 - fs: Is the package name mentioned below correct?
    </remark>
    
    <para>
        Backing up only these files and directories requires reinstalling the
        &susemgr; RPMs and re-registering &susemgr; (see <xref
          linkend="sec.manager.inst.installation"/>). In addition, packages
        need to be resynchronized using the <filename>mgr-ncc-sync</filename>
        tool. Finally, you have to reinstall the <filename>/root/ssl-build/rhn-org-httpd-ssl-key-pair-<replaceable>MACHINE_NAME-VER-REL</replaceable>.noarch.rpm</filename>.
    </para>
    
    <para>
        Another method is to back up all the files and directories mentioned
        above but reinstall the &susemgr; without re-registering it. During the
        installation, cancel or skip the registration and SSL certificate
        generation sections.
    </para>
    
    <para>
        The most comprehensive method is to back up the entire machine. This
        saves time in downloading and reinstalling but requires additional disk
        space and backup time.
    </para>
    
    <note>
        <para>
            Regardless of the backup method used, when restoring &susemgr; from a
            backup, you must run the following command to schedule the recreation of
            search indexes the next time the <command>rhn-search</command> service
            is started:
        </para>
        <remark condition="clarity">
            2011-02-02 - fs: What about rhn-search ?
        </remark>
        <screen>rcrhn-search cleanindex</screen>
    </note>
</sect1>

