<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:novdoc-profile.xsl" 
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE sect1 PUBLIC
  "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
  <sect1 id="sec.update.online.wagon">
   <title>Online Migration with &yast; <guimenu>Wagon</guimenu></title>
   <remark>emap: copied from SLE documentation</remark>
   <para>
    An online migration is conveniently performed with &yast; Wagon.
   </para>
  <procedure>
    <step>
     <para>
      When all requirements are met (system is registered with Novell
      Customer Center and latest updates are installed), the update
      applet in the tray will display a message that a distribution
      upgrade is available. Click it to start &yast;
      <guimenu>Wagon</guimenu>. Alternatively run
      <command>/usr/sbin/wagon</command> as &rootuser; from the
      command line.
     </para>
    </step>
    <step>
     <para>
      Confirm the <guimenu>Welcome</guimenu> dialog with
      <guimenu>Next</guimenu>.
     </para>
    </step>
    <step>
     <para>
      If <guimenu>Wagon</guimenu> finds that the requirements are not met
      (required maintenance updates are available but not yet installed), it
      will do an automatic self-update, which may require a reboot. Follow
      the on-screen instructions.
     </para>
    </step>
    <step>
     <para>
      Choose the update method in the following dialog. Select
      <guimenu>Customer Center</guimenu> to use the default setup
      (recommended).
     </para>
     <para>
      Click <guimenu>Custom URL</guimenu> to manually choose the software
      channels used for the online migration. A list of channels will be
      displayed, providing the opportunity to manually enable, disable, add,
      or delete channels. Add the &susemgr; update source(s). This can either be
      the &susemgr; installation media or the <literal>SUSE-Manager-Server-2.1-Pool</literal> and
      <literal>SUSE-Manager-Server-2.1-Updates</literal> channels. Click <guimenu>OK</guimenu>
      to return to the <guimenu>Update Method</guimenu> dialog.
     </para><remark role="needinfo">emap: Will SUMa channels really get these names?</remark>
     <para>
      If you want to review changes to the channel setup caused by the
      update process, select <guimenu>Check Automatic Repository
      Changes</guimenu>.
     </para>
     <para>
      Proceed with <guimenu>Next</guimenu>.
     </para>
    </step>
    <step>
     <para>
      The system will be re-registered. During this process the
      <literal>Pool</literal> and <literal>Updates</literal>
      channels will be added to the system. Confirm the addition of the channels.
     </para>
    </step>
    <step>
     <para>
      If you have selected <guimenu>Check Automatic Repository
      Changes</guimenu> in the <guimenu>Update Method</guimenu> dialog, the
      list of repositories will be displayed, providing the opportunity to
      manually enable, disable, add, or delete channels. Proceed with
      <guimenu>OK</guimenu> when finished.
     </para>
    </step>
    <step>
     <para>
      The <guimenu>Distribution Upgrade Settings</guimenu> screen opens and
      presents a summary of the update configuration. The following
      sections are available:
     </para>
     <variablelist>
      <varlistentry>
       <term><guimenu>Add-On Products</guimenu>
       </term>
       <listitem>
        <para>
         Do not select any add-on products during migration.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>Update Options</guimenu>
       </term>
       <listitem>
        <para>
         Lists the actions that will be performed during the update. You can
         choose whether to download all packages before installing them
         (default, recommended), or whether to download and install packages
         one by one.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term><guimenu>Packages</guimenu>
       </term>
       <listitem>
        <para>
         Statistical overview of the update.
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>Backup</term>
       <listitem>
        <para>
         Set backup options.
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
     <para>
      Click <guimenu>Next</guimenu> and <guimenu>Start The Update</guimenu>
      to proceed.
     </para>
     <important>
      <title>Aborting the Online Migration</title>
      <para>
       It is safe to abort the online migration on this screen
       <emphasis>prior</emphasis> to clicking <guimenu>Start The
       Update</guimenu> and on all previous screens. Click
       <guimenu>Abort</guimenu> to leave the update procedure and restore
       the system to the state it was in prior to starting &yast; Wagon.
       Follow the instructions on screen and perform a re-registration
       before leaving Wagon to remove obsolete channels from your system.
      </para>
     </important>
    </step>
    <step>
     <para>
      During the update procedure the following steps are executed:
     </para>
     <substeps>
      <step>
       <para>
        Packages will be updated.
       </para>
      </step>
      <step>
       <para>
        The system will be rebooted (press <guimenu>OK</guimenu>).
       </para>
      </step>
      <step>
       <para>
        The newly updated system will be re-registered.
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <!-- https://bugzilla.suse.com/show_bug.cgi?id=902373 -->
     <para>
      After the service pack migration has finished successfully, reboot
      the server.  Then, to complete the &susemgr; server upgrade run:
     </para>
<screen>/usr/lib/susemanager/bin/susemanager-upgrade.sh</screen>
    </step>
    <step>
     <para>
      Your system has been successfully updated to &susemgr; 2.1.
     </para>
    </step>
   </procedure>
   <important>
    <title>Upgrading the Database Schema</title>
     <para>
      During first startup several errors will occur because of an
      invalid database schema. Run the script
      <command>susemanager-upgrade</command>, which prepares the
      database for the schema upgrade, performs the upgrade, and
      converts configuration variables from
      <filename>rhn.comf</filename> to the database.
     </para> 
   </important>
  </sect1>
