<?xml version="1.0"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:novdoc-profile.xsl" 
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE chapter PUBLIC
  "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<chapter id="ch-multiorg">
 <title>Managing Multiple Organizations</title>
 <para>
  With &susemgr; you can create and manage multiple organizations. Divide
  systems, content, and subscriptions in different organizations or specific
  groups, for example, to reflect departments, teams or projects. This
  chapter guides you through basic setup tasks and explains the concept of
  multiple organization, as well as their creation and management with
  &susemgr;.
 </para>
 <para>
  During installation and setup, &susemgr; automatically creates a default
  administrative organization. It gets the organization ID
  <literal>1</literal> and the organization name that you entered in
  <xref linkend="step.manager.setup.org"/> in
  <xref linkend="pro.manager.setup"/>.
 </para>
 <sect1 id="s1-multiorg-models">
  <title>Recommended Models for Using Multiple Organizations</title>

  <para>
   The following examples detail two possible scenarios using the multiple
   organizations (or multi-org) feature.
<!--Installing or upgrading to RHN Satellite 5.1 or later does not require
   that you make use of the multi-org feature.
   There's no need to figure out and plan all necessary organizations on
   your &susemgr; up front. Start using organizations at whatever pace makes
   the most sense for you.--> It may be a good idea to create an additional
   organization for a limited set of systems and users to experiment with
   and fully understand the impact of a multi-org &susemgr; on your
   processes and policies before you design the best setup for your
   purposes.
  </para>

  <sect2 id="s2-multiorg-models-central">
   <title>Centrally-Managed &susemgr; for a Multi-Department Organization</title>
   <para>
    In this first scenario, &susemgr; is maintained by a central group of
    administrators within a business or other organization (refer to
    <xref linkend="fig-multiorg1-fig"/>). The &susemgr; administrator treats
    <systemitem> organization 1</systemitem> as a staging area for software
    and system subscriptions and entitlements.
   </para>
   <para>
    The &susemgr; administrator's responsibilities include the configuration
    of &susemgr; (any tasks available under the <guimenu>Admin</guimenu>
    area of the Web interface), the creation and deletion of additional
    &susemgr; organizations, and the allocation and removal of software and
    system subscriptions and entitlements.
   </para>
   <para>
    Additional organizations in this example are mapped to departments
    within a company. One way to divide the various departments in an
    organization is to consider which departments purchase subscriptions and
    entitlements for use with &susemgr;. To maintain centralized control
    over all organizations in &susemgr;, create an organization
    administrator account in each new organization and assign the role to
    yourself for full access.
   </para>
   <figure id="fig-multiorg1-fig">
    <title>Centralized &susemgr; Management for a Departmental Organization</title>
    <mediaobject>
     <imageobject role="html">
      <imagedata fileref="multiorg1.png" width="600"/>
     </imageobject>
     <imageobject role="fo">
      <imagedata fileref="multiorg1.png" width="70%"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 id="s2-multiorg-models-decentral">
   <title>Decentralized Management of Multiple Third Party Organizations</title>
   <para>
    In this example, &susemgr; is maintained by a central group, but each
    organization is treated separately without relations or ties between the
    different organizations on &susemgr;. Let's assume each organization is
    a customer of your company. You manage the &susemgr; application
    while other administrators take care of their respective organizations.
   </para>
   <para>
    While a &susemgr; consisting of sub-organizations that are all part of
    the same company may be more tolerant of sharing systems and content
    between organizations, in this decentralized example sharing is not
    tolerable. Administrators can allocate entitlements in specific amounts
    to each organization. Each organization will have access to all &suse;
    content synced to &susemgr; if the organization has software channel
    entitlements for the content.
   </para>
   <para>
    However, if one customer pushes custom content to their organization, it
    will not be available to other organizations. You as the &susemgr;
    administrator would have to push the content to all or selected
    organizations if you have the necessary access rights.
   </para>
   <para>
    In this scenario, it might make sense for &susemgr; administrators to
    reserve an account in each organization (by adding the organization
    administrator role for the respective organization). For example, if you
    are using &susemgr; to provide managed hosting services to external
    parties, you might need to access systems in that organization and push
    content.
   </para>
   <figure id="fig-multiorg2-fig">
    <title>Decentralized &susemgr; Management for Multi-Department Organization</title>
    <mediaobject>
     <imageobject role="html">
      <imagedata fileref="multiorg2.png" width="600"/>
     </imageobject>
     <imageobject role="fo">
      <imagedata fileref="multiorg2.png" width="70%"/>
     </imageobject>
    </mediaobject>
   </figure>
  </sect2>

  <sect2 id="s2-multiorg-bestpractices">
   <title>Recommendations for Using Multiple Organizations</title>
   <para>
    Regardless of which scenario you choose for managing your
    multi-org &susemgr;, the following best practices tips can help.
   </para>
   <note>
    <title>Use of Default Administrative Organization</title>
    <para>
     For managing multiple organization, create new, dedicated organizations
     within &susemgr;. The default administrative organization receives
     special treatment with regard to subscriptions and entitlements.
     Therefore do <emphasis>not</emphasis> use the default administrative
     organization for registering client systems and creating users in a
     multi-organization setup. However, in the following cases it is
     unproblematic to do so:
    </para>
    <itemizedlist>
     <listitem>
      <para>
       if you use &susemgr; in a single-organization setup,
      </para>
     </listitem>
     <listitem>
      <para>
       during the migration from a single-organization setup to a
       multi-organization setup.
      </para>
     </listitem>
    </itemizedlist>
   </note>
   <para>
    The administrative organization is a staging area for
    subscriptions and entitlements. When you associate &susemgr; with a new
    certificate, any new entitlements will be granted to this organization
    by default. To make these new entitlements available to other
    organizations on &susemgr;, you will need to explicitly allocate these
    entitlements to other organizations from the administrative
    organization. Vice versa, if you remove entitlements from other
    organizations, they will automatically be re-assigned to the default
    organization.
   </para>
   <sect3 id="s3-multiorg-bestpractices-cert1">
    <title>Certificate Has Less Entitlements Than Are Used</title>
    <para><remark>emap: RH moved this to trouble shooting chapter. Might make sense for us as well, though here it might be more helpful right away.</remark>
     If you have issued a new &susemgr; certificate and it contains less
     entitlements than the systems in the organizations of your &susemgr;
     are consuming, you cannot activate this new certificate. You will get
     an error stating that there are insufficient entitlements in the
     certificate.
    </para>
    <para>
     There are a few ways you can reduce &susemgr; entitlement usage in
     order to activate your new certificate. Evaluate each organization's
     entitlement usage and decide which organizations can relinquish some
     entitlements and still function properly. Contact each organization
     administrator directly and request that they unentitle or delete the
     system profiles of any extraneous systems in their organizations. If
     you also have the organization administrator role for these
     organizations, you can do this yourself. Logged in as a &susemgr;
     administrator, you cannot decrement the allocated entitlements to an
     organization below the number of entitlements associated with system
     profiles.
    </para>
    <para>
     There are some situations in which you might need to free entitlements quickly
     and may not have access to each organization. There is an option in
     multi-org &susemgr;s that allows the server administrators to reduce an
     organization's entitlement count below usage. In this case, log in to the
     administrative organization and proceed as described below:
    </para>
    <procedure>
     <step>
      <para>
       In the <filename>/etc/rhn/rhn.conf</filename> file set
       the <systemitem>web.force_unentitlement</systemitem> variable to <literal>1</literal>:
      </para>
<screen>web.force_unentitlement=1</screen>
      <para>
       This setting allows to decrement an organization's allocated
       entitlements below what they are using. If an organization has more
       entitlements than are being actively used, you do not need to change
       this variable to remove entitlements.
      </para>
     </step>
     <step>
      <para>
       Restart &susemgr;:
      </para>
<screen>spacewalk-service restart</screen>
     </step>
     <step>
      <para>
       Log in to the &susemgr; default organization in the &susemgr; Web
       interface:
      </para>
     </step>
     <step id="st.s3-multiorg-bestpractices-cert1.entitlements">
      <para>
       Reduce the allocated entitlements either via each organization's
       <guimenu>Subscriptions</guimenu> tab or via individual entitlement's
       <guimenu>Organizations</guimenu> tabs.
      </para>
     </step>
     <step>
      <para>
       A number of systems in the organization should now be in an
       <guimenu>unentitled</guimenu> state. These are the systems most
       recently registered with the organization. The number of unentitled
       systems is equal to the difference between the total number of
       entitlements you removed from the organization and the number of
       entitlements the organization did not have applied to the systems.
      </para>
      <para>
       For example, if you removed 10 entitlements from the organization in
       <xref linkend="st.s3-multiorg-bestpractices-cert1.entitlements"/>,
       and the organization has four entitlements that were not in use by
       systems, then 6 systems in the organization will be unentitled.
      </para>
     </step>
    </procedure>
    <para>
     After you have a sufficient number of entitlements, you should be able to
     activate your new &susemgr; certificate. Note that modifying the
     <systemitem>web.force_unentitlement</systemitem> variable is only
     necessary to reduce an organization's allocated entitlements below what
     they are using. If an organization has more entitlements than are being
     actively used, you do not need to set this variable to remove them.
    </para>
   </sect3>
   <sect3 id="s3-multiorg-bestpractices-cert2">
    <title>Certificate Has More Entitlements Than Are Used</title>
    <para>
     If you are issued a new &susemgr; certificate and it has more
     entitlements than are being consumed on your &susemgr;, any extra
     entitlements will be assigned to the administrative
     organization. If you log into the Web interface as the &susemgr;
     administrator, you will be able to allocate these entitlements to
     other organizations. Entitlements previously allocated to other
     organizations will be unaffected.
    </para>
   </sect3>
  </sect2>
 </sect1>
 <sect1 id="s1-sattools-org">
  <title>Organizations</title>
  <para>
   The <guimenu>Organizations</guimenu> page in the Web interface allows
   administrators to view, create, and manage multiple organizations across
   &susemgr;. Administrators can allocate software and system entitlements
   across various organizations, as well as control an organization's access
   to systems management tasks.
  </para>

  <figure>
   <title>Admin</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="sattools-orgs.png" width="444"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="sattools-orgs.png" width="444"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   The <guimenu>Organizations</guimenu> page lists organizations across the
   &susemgr;, with both user and system counts assigned to each
   organization. The <guimenu>Organizations</guimenu> page also features a
   <guimenu>Trusts</guimenu> page for any organizational trusts established.
   Refer to <xref linkend="s1-sattools-orgs-trust"/> for more information
   about establishing organizational trusts.
  </para>

  <sect2 id="s2-sattools-org-details">
   <title><guimenu>Admin</guimenu> > <guimenu>Organizations</guimenu> > <guimenu>Details</guimenu></title>
   <para>
    Clicking on an organization displays the <guimenu>Details</guimenu>
    page, where administrators are provided with a summary of various
    aspects of the organization.
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <guimenu>Active Users</guimenu> — The number of users in the
      organization.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>Systems</guimenu> — The number of systems subscribed to the
      organization.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>System Groups</guimenu> — The number of groups subscribed
      to the organization.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>Activation Keys</guimenu> — The number of activation keys
      available to the organization.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>Autoinstallation Profiles</guimenu> — The number of
      autoinstallation profiles available to the organization.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>Configuration Channels</guimenu> — The number of
      Configuration Channels available to the organization.
     </para>
    </listitem>
   </itemizedlist>
   <para>
    On this page, you can also delete an organization by clicking the
    <guimenu>Delete Organization</guimenu> link.
   </para>
   <para>
    The <guimenu>Details</guimenu> page also contains three subtabs:
    <guimenu>Users</guimenu>, <guimenu>Subscriptions</guimenu>, and
    <guimenu>Trusts</guimenu>.
   </para>
  </sect2>
 </sect1>
 <sect1 id="s1-multiorg-creating">
  <title>Managing Organizations</title>

  <para>
   Administrators can create new organizations and assign entitlements,
   groups, systems, and users to it. This enables organizations to perform
   administrative tasks on their own without affecting other organizations.
   During creation of a new organization, you also need to create an
   (initial) organization administrator account. &susemgr; administrators
   should reserve the initial organization administrator for themselves to
   be able to log into this organization when necessary.
  </para>

  <note>
   <title>PAM Accounts</title>
   <para>
    If your &susemgr; is configured for PAM authentication, avoid using PAM
    accounts for the main organization administrator account in new
    organizations.  Instead, create a &susemgr;-local account for organization
    administrators. Reserve PAM-authenticated accounts for &susemgr; logins
    with less elevated privileges.
   </para>
   <para>For more information about PAM, see <xref
   linkend="s1-maintenance-pam-auth"/>.</para><remark>emap: another reference that points to a Maintenance, Installation &map; Troubleshooting Guide.</remark>
  </note>

  <procedure id="pro.manager.config.orga">
   <title>Creating and Deleting Organizations</title>
   <step>
    <para>
     Log in to the Web interface as &susemgr; administrator or organization
     administrator.
    </para>
   </step>
   <step>
    <para>
     Procedure to create an organization:
    </para>
    <substeps>
     <step>
      <para>
       Switch to the <guimenu>Admin</guimenu> tab to see a list of all
       <guimenu>Organizations</guimenu> within &susemgr;.
      </para>
     </step>
     <step>
      <para>
       Click the <guimenu>Create New Organization</guimenu> link at the top
       right corner.
      </para>
     </step>
     <step>
      <para>
       Enter an <guimenu>Organization Name</guimenu>.
      </para>
     </step>
     <step>
      <para>
       To create the initial organization administrator for the new
       organization, enter the <guimenu>Desired Login</guimenu> and the
       <guimenu>Desired Password</guimenu> for the new user and confirm the
       password.
      </para>
      <tip>
       <title>Login Names</title>
       <para>
        For the organization administrator account use a login name that can
        easily be matched with the organization, for example:
        <systemitem class="username">orgadmin-mktg</systemitem> or
        <systemitem class="username">eng-dept-admin</systemitem>.
       </para>
      </tip>
      <figure>
       <title>Create New Organization</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="sattools-orgs-new.png" width="444"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="sattools-orgs-new.png" width="444"/>
        </imageobject>
       </mediaobject>
      </figure>
     </step>
     <step>
      <para>
       Enter the first and last name and the email address of the new user.
      </para>
     </step>
     <step>
      <para>
       To finish, click <guimenu>Create Organization</guimenu>. Once the new
       organization is created, the <guimenu>Organizations</guimenu> page
       will list the new organization.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Procedure to delete an organization:
    </para>
    <substeps>
     <step>
      <para>
       On the <guimenu>Admin</guimenu> tab, select
       <guimenu>Organizations</guimenu> from the left navigation bar.
      </para>
     </step>
     <step>
      <para>
       Click the desired organization to see the organization details.
      </para>
     </step>
     <step>
      <para>
       Click the <guimenu>Delete Organization</guimenu> link at the upper
       right corner and confirm by clicking the <guimenu>Delete
       Organization</guimenu> button.
      </para>
     </step>
    </substeps>
   </step>
  </procedure>
 </sect1>
 <sect1 id="s1-admin-orgs-details-subs">
  <title>Managing Organization Entitlements</title>

  <para>
   One important task after creating a new organization is to assign
   entitlements to the new organization. There are two types of entitlements
   that are important:
  </para>

  <variablelist>
   <varlistentry>
    <term>System Entitlement - Management</term>
    <listitem>
     <para>
      Management entitlements are a base requirement for an organization to
      function in &susemgr;. The maximum number of systems that may register
      with an organization in &susemgr; depends on the number of management
      entitlements allocated to that organization&mdash;regardless of the
      number of software entitlements available. For example, if there are 100
      &sle; client entitlements but only 50 management system entitlements to
      an organization, only 50 systems can register with that
      organization. Provisioning is also recommended, especially for systems
      managed in organizations.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Software Channel Entitlements</term>
    <listitem>
     <para>
      Apart from system entitlements, software channel entitlements are
      needed for each organization. For example, you must grant
      <systemitem>client tools</systemitem> channel entitlements to each
      organization (as this channels contains client software required for
      extended &susemgr; functionality, such as &ay; or Kickstart or
      virtualization support).
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   From the <guimenu>Admin</guimenu> tab in the Web interface you can manage
   and assign both types of entitlements by selecting either
   <menuchoice><guimenu>Subscription</guimenu><guimenu>Software Channel
   Entitlements</guimenu></menuchoice> or
   <menuchoice><guimenu>Subscription</guimenu><guimenu>System
   Entitlements</guimenu></menuchoice> from the left navigation bar. For a
   detailed description of those pages in the Web interface, refer to
   <xref linkend="s2-sattools-orgs-subs-soft"/> and
   <xref linkend="s2-sattools-orgs-subs-sys"/>.
  </para>

  <para>
   The default organization automatically gets the needed system and
   software entitlements during the synchronization with
   <command>mgr-ncc-sync</command>. To transfer the respective entitlements
   from the default organization to any newly created organization, proceed
   as described in <xref linkend="pro.manager.config.entitlements"/>.
  </para>

  <procedure id="pro.manager.config.entitlements">
   <title>Assigning Entitlements to an Organization</title>
   <step>
    <para>
     Log in to the &susemgr; Web interface as &susemgr; administrator.
    </para>
   </step>
   <step>
    <para>
     Switch to the <guimenu>Admin</guimenu> tab and from the left navigation
     bar, select <guimenu>Organizations</guimenu>.
    </para>
   </step>
  <step>
    <para>
     Select the organization for which to assign or change entitlements and
     select the <guimenu>Subscriptions</guimenu> subtab.
    </para>
   </step>
   <step>
    <para>
     To set any system entitlements for the selected organization:
    </para>
    <substeps>
     <step>
      <para>
       Click the <guimenu>System Entitlements</guimenu> subtab to view the
       <guimenu>System Entitlements Counts</guimenu>.
      </para>
     </step>
     <step>
      <para>
       Set the total number of <guimenu>Management (Base)</guimenu>
       entitlements for the current organization by entering a value in the
       <guimenu>Proposed Total</guimenu> field.
      </para>
     </step>
     <step>
      <para>
       Similarly, set total numbers for any other entitlements you may need
       (like monitoring, provisioning, or virtualization).
      </para>
     </step>
     <step>
      <para>
       Click <guimenu>Update Organization</guimenu> to confirm your changes.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     To set software channel entitlements for the selected organization:
    </para>
    <substeps>
     <step>
      <para>
       Click the <guimenu>Software Channel Entitlements</guimenu> subtab to
       view the <guimenu>Software Channel Entitlements Counts</guimenu>.
      </para>
     </step>
     <step>
      <para>
       For any channel that should be available to the client systems of the
       current organization, enter the desired number of entitlements for
       this channel in the <guimenu>Regular Proposed Total</guimenu> field.
      </para>
     </step>
     <step>
      <para>
       Click <guimenu>Update Organization</guimenu> to confirm your changes.
      </para>
     </step>
    </substeps>
   </step>
  </procedure>

  <para>
   Any number of system or software entitlements assigned to an organization
   are deducted from the total number of system or software entitlements.
  </para>

  <para>
   To view the total number of software entitlements across all
   organizations in &susemgr;, switch to the <guimenu>Admin</guimenu> tab
   and select <menuchoice><guimenu>Subscriptions</guimenu><guimenu>Software
   Channel Entitlements</guimenu></menuchoice>.
  </para>

  <sect2 id="s2-sattools-orgs-subs-soft">
   <title><guimenu>Admin</guimenu> > <guimenu>Subscriptions</guimenu> > <guimenu>Software Channel Entitlements</guimenu></title>
   <para>
    The <guimenu>Software Channel Entitlements Across &susemgr;</guimenu>
    page lists all entitlements on &susemgr; across all organizations, as
    well as their usage. Click on an <guimenu>Entitlement Name</guimenu> for a
    more detailed view.
   </para>
   <para>
    The <guimenu>Details</guimenu> subtab for the software channel
    entitlement contains information about the software channel access
    granted by the entitlement.
   </para>
   <note>
    <title>Custom Channels and Organizational Trusts</title>
    <para>
     When organization administrators create a custom channel, they can use
     that channel only within their organization unless an organizational
     trust is established between the organizations that want to share the
     channel. For more information about organizational trusts, refer to
     <xref linkend="s1-sattools-orgs-trust"/>.
    </para>
   </note>
  </sect2>

  <sect2 id="s2-sattools-orgs-subs-sys">
   <title><guimenu>Admin</guimenu> > <guimenu>Subscriptions</guimenu> > <guimenu>System Entitlements</guimenu></title>
   <para>
    The <guimenu>System Entitlements Across &susemgr;</guimenu> page
    lists all system entitlements on this &susemgr;, across all
    organizations, as well as their usage. Allocations of
    each system entitlement can be changed in the text box.
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <guimenu>Bootstrap (Add-On)</guimenu>: system can be configured
      via bootstrap. For more details, see <xref
      linkend="ch-bootstrap"/>.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>Management (Base)</guimenu>: a base requirement for all
      organizations to function correctly. The number of management
      entitlements allocated to an organization is equivalent to the
      maximum number of systems that can register to that
      organization, regardless of the number of software entitlements
      available.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>Monitoring (Add-On)</guimenu>: enables the tracking of
      monitoring data for a system. For more details on monitoring, refer to <xref
      linkend="s1-sm-monitor"/>.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>Provisioning (Add-On)</guimenu>: allows various
      advanced functionality such as autoinstallation and
      configuration file provisioning. Recommended especially for
      systems managed in organizations.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>Virtualization (Add-On)</guimenu>: not used in &susemgr;.
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>Virtualization Platform (Add-On)</guimenu>: applied to
      a &vmhost; system with unlimited guest management enabled.
     </para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
 <sect1 id="s1-multiorg-systems">
  <title>Configuring Systems in an Organization</title>

  <para>
   After a new organization has been created and requisite entitlements
   assigned to it, you can assign systems to each organization.
  </para>

  <para>
   There are two basic ways to register a system with a particular
   organization:
  </para>

  <orderedlist>
   <listitem>
    <para>
     Registering Using Login and Password — If you provide a login and
     password created for a specific organization, the system will be
     registered with that organization. For example, if
     <literal>user-123</literal> is a member of the <guimenu>Central
     IT</guimenu> organization on &susemgr;, the following command would
     register that system with the <guimenu>Central IT</guimenu>
     organization on your &susemgr;:
    </para>
<screen>mgrreg_ks --username=user-123 --password=foobaz</screen>
<!--<note>
     <para>
      The <parameter>-/-orgid</parameter>
<!-\-(for Red Hat Enterprise Linux 4 and
      5)-\->
      and <parameter>-/-orgpassword</parameter>
<!-\-(in RHEL 4)-\->
      parameters in <command>mgrreg_ks</command> are <emphasis>not
      related</emphasis> to &susemgr; registration or &susemgr;'s multiple
      organizations support.<remark>emap 2011-03-23: Since these two parameters are mentioned,
  user will wonder what they are actually there for. I'd delete or elaborate.</remark> 
     </para>
    </note>-->
   </listitem>
   <listitem>
    <para>
     Registering Using an Activation Key — You can also register a system
     with an organization using an activation key from the organization.
     Activation keys will register systems with the organization in which
     the activation key was created. Activation keys are a good registration
     method to use if you want to allow users to register systems with an
     organization without providing them login access to that organization.
     If you want to move systems between organizations, you may also
     automate the move with scripts using the activation keys. The prefix of
     the activation key indicates which organization (by ID number) owns the
     activation.
    </para>
   </listitem>
  </orderedlist>
 </sect1>
 <sect1 id="s1-sattools-orgs-trust">
  <title>Organizational Trusts</title>

  <para>
   Organizations can share their resources with each other by
   establishing an organizational trust in &susemgr;. An
   organizational trust is bi-directional, meaning that once a
   &susemgr; administrator establishes a trust between two or more
   organizations, it is up to each organization's administrator to
   determine what resources to share, and what shared resources from
   other organizations in the trust to use. With trust established, it
   is possible to share content and migrate systems between these two
   organizations.
  </para>

  <note>
   <para>
    Only organization administrators have the rights to share their custom
    content. The &susemgr; administrator role is limited to allocating
    system and software entitlements to each organization.
   </para>
  </note>

  <sect2 id="s2-sattools-orgs-trusts-establish">
   <title>Establishing an Organizational Trust</title>
   <para>
    A &susemgr; administrator can create a trust between two or more
    organizations.
    To do this, click the <guimenu>Organizations</guimenu> link in the side
    menu on the <guimenu>Admin</guimenu> main page.
   </para>
   <para>
    Click the name of one of the organizations and within the
    <guimenu>Details</guimenu> page, click the <guimenu>Trusts</guimenu>
    subtab.
   </para>
   <para>
    On the <guimenu>Trusts</guimenu> subtab, there is a listing of all the
    other trusts on &susemgr;. Here you may use the <guimenu>Filter by
    Organization</guimenu> text box to narrow down a long list of
    organizations to a specific subset.
   </para>
   <figure>
    <title>Organizational Trusts</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="org-trusts2.png" width="444"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="org-trusts2.png" width="444"/>
     </imageobject>
    </mediaobject>
   </figure>
   <para>
    Click the checkbox next to the names of the organizations you want to be
    in the organizational trust with the current organization and click the
    <guimenu>Modify Trusts</guimenu> button.
   </para>
  </sect2>

  <sect2 id="s2-sattools-orgs-trusts-share">
   <title>Sharing Content Channels between Organizations in a Trust</title>
   <para>
    Once an organizational trust has been established, organizations can now
    share content such as custom software channels with the other
    organizations in the trust. There are also three levels of channel
    sharing that can be applied to each channel for finer-grained channel
    access control.
   </para>
   <note>
    <para>
     Organizations cannot share &suse; channels because they are available
     to all organizations that have entitlements to those channels.
    </para>
   </note>
   <para>
    To share a custom channel with another organization, perform the
    following steps:
   </para>
   <procedure>
    <step>
     <para>
      Login to &susemgr; with the username of the organization
      administrator.
     </para>
    </step>
    <step>
     <para>
      Click on the <guimenu>Channels</guimenu> tab.
     </para>
    </step>
    <step>
     <para>
      On the side menu, click <guimenu>Manage Software Channels</guimenu>.
     </para>
    </step>
    <step>
     <para>
      Click the custom channel that you want to share with the other
      organizations.
     </para>
    </step>
    <step>
     <para>
      From the <guimenu>Channel Access Control</guimenu> section of the
      <guimenu>Details</guimenu> page, there are three choices in
      <guimenu>Organizational Sharing</guimenu>.
     </para>
     <itemizedlist>
      <listitem>
       <para>
        <guimenu>Private</guimenu> — Make the channel private so that it
        cannot be accessed by any organizations except the channel's owner.
       </para>
      </listitem>
      <listitem>
       <para>
        <guimenu>Protected</guimenu> — Allow the channel to be accessed by
        specific trusted organizations of your choice.
       </para>
       <note>
        <para>
         If you choose <guimenu>Protected</guimenu> sharing, a separate page
         prompts you to confirm that you are granting channel access to the
         selected organizations by clicking <guimenu>Grant Access and
         Confirm</guimenu>.
        </para>
       </note>
      </listitem>
      <listitem>
       <para>
        <guimenu>Public</guimenu> — Allow all organizations within the
        trust to access the custom channel.
       </para>
      </listitem>
     </itemizedlist>
     <para>
      Click the radio button next to your selection and click
      <guimenu>Update Channel</guimenu>.
     </para>
    </step>
   </procedure>
   <para>
    Now, other organization administrators within the trust for which
    you have granted access to your custom channel can allow their client
    systems to install and update packages from the shared channel.
   </para>
   <note>
    <para>
     If you have a system subscribed to a shared channel, and the
     organization administrator of the shared channel changes access rights
     removing your organization, your system loses that channel. If it was
     used as base channel, your system will no longer have a base channel on
     the <guimenu>Systems</guimenu> page and will not receive updates.
    </para>
   </note>
  </sect2>

  <sect2 id="s2-sattools-orgs-trusts-migrate">
   <title>Migrating Systems from One Trusted Organization to Another</title>
   <para>
    In addition to sharing software channels, organizations in a trust can
    migrate systems to other trusted organizations via the &susemgr; web
    interface or by using a utility called
    <command>migrate-system-profile</command>.
   </para>
   <note>
   <para>
    The &susemgr; administrator can migrate a system from one trusted
    organization to any other within the trust. However, organization
    administrators can only migrate a system from their own organization to
    another in the trust.
   </para>
   </note>
   <para>
     Using the web interface to migrate systems, click
     <menuchoice><guimenu>Systems</guimenu><guimenu>Systems</guimenu></menuchoice>.
     Click on the system name. On the subtab
     <menuchoice><guimenu>Details</guimenu><guimenu>Migrate</guimenu></menuchoice>,
     choose the organization the system needs to migrate to. Click
     <guimenu>Migrate System</guimenu>. The system is successfully migrated to
     the target organization.
   </para>
   <para>
    The command-line tool <command>migrate-system-profile</command> uses
    systemIDs and orgIDs as arguments to specify what is being moved and its
    destination organization.
   </para>
   <para>
    To use the <command>migrate-system-profile</command> command, you must
    have the <filename>spacewalk-utils</filename> package installed. You do
    not need to be logged into the &susemgr; server to use
    <command>migrate-system-profile</command>; however, if you do not log
    in, you will need to specify the hostname or IP address of the server as
    a command-line argument.
   </para>
   <note>
    <para>
     When an organization migrates a system with the
     <command>migrate-system-profile</command> command, the system does not
     carry any of the previous entitlements or channel subscriptions from
     the source organization. However, the system's history is preserved,
     and can be accessed by the new organization administrator in order to
     simplify the rest of the migration process, which includes subscribing
     to a base channel and granting entitlements.
    </para>
   </note>
    <para>
     Verify the ID of the system to be migrated, the ID of the organization
     the system will migrate to (available in the web interface or use the
     <command>spacewalk-report</command> tool), and the hostname or IP address
     of the &susemgr; server if you are running the command from another
     machine.
    </para>
    <para>
     Use the following command:
    </para>
<screen>migrate-system-profile --satellite <replaceable>{&susemgr; HOSTNAME OR IP}</replaceable> --systemId=<replaceable>{SYSTEM ID}</replaceable> --to-org-id=<replaceable>{DESTINATION ORGANIZATION ID}</replaceable></screen>
    <para>
     In the following example, the Finance department (created as an
     organization in &susemgr; with OrgID 2) wants to migrate a workstation
     (with SystemID 10001020) from the Engineering department, but the
     Finance organization administrator does not have shell access to the
     &susemgr; server. The &susemgr; hostname is
     <guimenu>satserver.example.com</guimenu>.
    </para>
    <para>
     The finance organization administrator would type the following command
     into a shell:
    </para>
<screen>migrate-system-profile --satellite satserver.example.com --systemId=10001020 --to-org-id=2</screen>
    <para>
     The finance organization administrator is then prompted for the
     username and password (unless they are specified by using
     <option>--username=</option> and <option>--password=</option> at the
     command-line).
    </para>
    <para>
     The system now shows up in the <guimenu>Systems</guimenu> page of the
     finance organization in the &susemgr; Web interface. The finance
     organization administrator can finish the migration process by
     assigning a base channel and granting entitlements to the client. Check
     the system's <guimenu>History</guimenu> page in the
     <guimenu>Events</guimenu> subtab to see previous subscriptions and
     entitlements.
    </para>
    <figure>
     <title>System History</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="migrate-history.png" width="444"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="migrate-history.png" width="444"/>
      </imageobject>
     </mediaobject>
    </figure>
    <para>
     To migrate several systems at once, &susemgr; administrators can use
     the <option>--csv</option> option of
     <command>migrate-system-profile</command> to automate the process using
     a simple comma-separated list of systems to migrate.
    </para>
    <para>
     A line in the CSV file should contain the ID of the system to be
     migrated as well as the destination organization's ID in the following
     format:
    </para>
<screen>systemId,to-org-id</screen>
    <para>
     A compatible CSV might look like this:
    </para>
<screen>1000010000,3
1000010020,1
1000010010,4</screen>
    <para>
     For more information about using
     <command>migrate-system-profile</command> refer to the manual page by
     typing <command>man migrate-system-profile</command> or for a basic
     help screen type <command>migrate-system-profile -h</command>.
    </para>
  </sect2>
 </sect1>
 <sect1 id="s1-sattools-orgs-users">
  <title><guimenu>Admin</guimenu> > <guimenu>Users</guimenu></title>
  <para>
   The <guimenu>Users Across &susemgr;</guimenu> page contains a list of all
   users on the &susemgr; throughout all organizations.
  </para>
  <note>
   <para>
    You are only able to modify the details of organization users if you are
    logged in as the responsible organization administrator.
   </para>
  </note>

  <para>
   Clicking the <guimenu>Username</guimenu> displays the <guimenu>User
   Details</guimenu> page. Refer to <xref linkend="s1-sm-users"/> for more
   information on user configuration.
  </para>

  <sect2 id="s2-sattools-orgs-details-users">
   <title><guimenu>Admin</guimenu> > <guimenu>Organizations</guimenu> > <guimenu>Details</guimenu> > <guimenu>Users</guimenu></title>
   <para>
    The <guimenu>Users</guimenu> subtab lists the users assigned to the
    organization, including their real names, email address, and a check
    mark indicating whether the user is an administrator of the
    organization.
   </para>
   <para>
    If you are the organization administrator, you can click the username to
    display the <guimenu>User Details</guimenu> page for the user. For
    instructions regarding user management, refer to
    <xref linkend="s3-sm-user-active-details"/>.
   </para>
   <note>
    <para>
     You must be logged in as the organization administrator to edit the
     User details for an organization. The &susemgr; administrator cannot
     edit user details for organization users.
    </para>
   </note>
  </sect2>
 </sect1>
</chapter>
