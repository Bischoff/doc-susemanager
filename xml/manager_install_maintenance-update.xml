<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:novdoc-profile.xsl" 
 type="text/xml"
 title="Profiling step"?>
<!DOCTYPE sect1 PUBLIC
  "-//Novell//DTD NovDoc XML V1.0//EN" "novdocx.dtd"
[
  <!ENTITY % NOVDOC.DEACTIVATE.IDREF "INCLUDE">
  <!ENTITY % entities SYSTEM "entity-decl.ent">
  %entities;
]>
<sect1 id="s1-maintenance-update">
    <title>Updating &susemgr;</title>
    
    <remark>taroth 2011-02-18: the following text was reviewed by mc, see also
        https://bugzilla.novell.com/show_bug.cgi?id=673040</remark><indexterm>
            
            <primary>updating &susemgr;</primary></indexterm>
    
    <para>
        If any critical updates are provided for &susemgr;, they will be released
        in the form of a patch for &susemgr;. Find a generic description on how
        to apply patches in <xref linkend="pro.manager.update.generic"/>.
        Depending on the patch, specific instructions may apply.
    </para>
    
    <para>
        For &susemgr; systems connected to the Internet, the best method for
        applying these patches is using <command>zypper</command> or &yast;
        Online Update. Proper registration at &ncc; is mandatory for the system
        to receive updates. For details, refer to
        <xref linkend="sec.manager.inst.installation"/>. &susemgr; systems not connected to
        the Internet (disconnected setup) will receive updates from an internal
        update server instead.
    </para>
    
    <para os="hidden">
        <remark condition="clarity"> 2011-02-02 - fs: Does this apply to SUSE as
            well?? </remark>
        For &susemgr; systems that are not be connected to the Internet, the
        packages themselves may be retrieved using a customer account at &ncc;.
        Then, they can be applied manually by the customer according to
        instructions in the patch advisory.
    </para>
    
    <para os="hidden">
        If you want to update the server's entitlement certificate, for example
        to increase its number of client systems, refer to
        <xref linkend="ch-entitlements"/> for instructions.
    </para>
    
    <procedure id="pro.manager.update.generic">
        <title>Updating a &susemgr; Server</title>
        <para>
            As soon as &susemgr; is up and running and the database is configured,
            updating the server requires more than executing <command>zypper
                patch</command> (or running &yast; Online Update alternatively).
        </para>
        <para>
            The steps below describe the generic procedure, but depending on the
            patch, specific instructions may apply.
        </para>
        <warning>
            <title>Read Patch Advisory</title>
            <para>
                Before applying any updates, make sure to read the patch advisory.
                Additional configuration steps may be required to apply certain
                updates, especially if they involve the database. In such cases, the
                advisory will contain specific and detailed information about necessary
                steps.
            </para>
        </warning>
        <step>
            <para>
                Log in as &rootuser; user to the &susemgr; server.
            </para>
        </step>
        <step>
            <para>
                Stop the Spacewalk service:
            </para>
            <screen>spacewalk-service stop</screen>
        </step>
        <step>
            <para>
                Apply the patch using either <command>zypper patch</command> or &yast;
                Online Update. For more information about <command>zypper</command> or
                &yast; Online Update, refer to <xref linkend="pup-sle"/>.
            </para>
        </step>
        <step>
            <para>
                If the patch includes an update of the database schema, proceed as
                follows (otherwise skip the substeps below):
            </para>
            <substeps>
                <step>
                    <para>
                        If the &susemgr; database is running on the same machine as your
                        &susemgr; server, start the database instance with
                    </para>
                    <!-- http://doccomments.provo.novell.com/comments/24219 -->
                    <screen>/etc/init.d/postgresql start</screen>
                    <para>or</para>
                    <screen>/etc/init.d/oracle-xe start</screen>
                </step>
                <step>
                    <para>
                        Upgrade the database schema with
                    </para>
                    <screen>spacewalk-schema-upgrade</screen>
                </step>
            </substeps>
        </step>
        <step>
            <para>
                Start the Spacewalk service:
            </para>
            <screen>spacewalk-service start</screen>
        </step>
    </procedure>
    
    <important>
        <title>Restart of Services and Applications</title>
        <remark>froh / bwiedemann:  2014-03-31  is this true for SUSE systems?
	</remark>
        <para>
            Services affected by a package update are not automatically restarted
            after the update&mdash;you need to restart them manually to avoid
            failures.
        </para>
        <para>
            Also execute <command>zypper ps</command> to check for any applications
            that still use old code. Restart those applications.
        </para>
    </important>
</sect1>


